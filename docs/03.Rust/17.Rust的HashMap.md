---
title: 17.Rust的HashMap
date: 2025-08-28 23:30:00
permalink: /pages/Rust_17/
---

# Rust 的 HashMap：键值对的老管家

Rust 的集合里，`Vec` 像是有序列表，`String` 是字符串专家，而 `HashMap` 就是大管家：**负责把键和对应的值捆在一起，方便快速查找**。

---

## 一、什么是 HashMap？

- **本质**：一个存储 **键–值对** 的集合。  
- **键（Key）**：可以是任何实现了 `Eq` 和 `Hash` 的类型（整数、字符串常用）。  
- **值（Value）**：可以是任意类型。  
- **查找效率**：理论上 O(1)，也就是非常快。

```rust
use std::collections::HashMap;

fn main() {
    let mut scores = HashMap::new();
    scores.insert(String::from("Blue"), 10);
    scores.insert(String::from("Red"), 50);
}

```

这段代码就建了一个球队分数表。

## 二、取值和遍历

你可以通过 `get` 来获取：

```rust
let team_name = String::from("Blue");
let score = scores.get(&team_name);
println!("{:?}", score); // Some(10)
```

`get` 返回的是 `Option<&V>`，所以要么是 `Some(值)`，要么是 `None`。

遍历所有键值对：

```rust
for (key, value) in &scores {
    println!("{key}: {value}");
}
```

------

## 三、更新 HashMap

HashMap 里的值可以覆盖，也可以按规则插入。

### 1. 直接覆盖

```rust
scores.insert(String::from("Blue"), 25); // 原来 10 变成 25
```

### 2. 只在键不存在时插入

用 `.entry()` 方法：

```rust
scores.entry(String::from("Yellow")).or_insert(30);
```

如果 `Yellow` 已经有分数，不会动；没有才会插入。

### 3. 根据旧值更新

```rust
let text = "hello world wonderful world";

let mut map = HashMap::new();
for word in text.split_whitespace() {
    let count = map.entry(word).or_insert(0);
    *count += 1;
}
println!("{map:?}");
```

这个例子就是 **统计词频**：

- `entry(word)` 先查看 key 是否存在；
- `.or_insert(0)` 表示如果不存在就插入 0；
- 然后 `*count += 1` 更新。

------

## 四、关于所有权的细节

- 如果你把 `String` 当作 key 或 value 插入 `HashMap`，它的所有权会被移动进 Map。
- 如果你只想借用，就要用引用类型。

```rust
let field_name = String::from("Favorite color");
let field_value = String::from("Blue");

let mut map = HashMap::new();
map.insert(field_name, field_value);

// field_name, field_value 已经失效
```

所以要么用 `.clone()`，要么一开始就存引用。

------

## 五、总结

- **HashMap** 用来存 **键值对**，快速查找，查不到返回 `None`。
- 常用操作：`insert`、`get`、`entry().or_insert()`。
- 注意所有权问题，插进去就不能再直接用了。
- 适合做配置表、统计、缓存等。

Rust 的集合三兄弟，到这儿算齐活了：

- `Vec` 管列表，
- `String` 管文本，
- `HashMap` 管键值关系。
