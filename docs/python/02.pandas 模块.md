---
title: 01.pandas æ¨¡å—
date: 2025-09-26 22:30:00
permalink: /pages/Python_02/
---

# pandas æ¨¡å—

## Pandas ç®€ä»‹

Pandasï¼ˆæ¥æºäº *Panel Data*ï¼‰æ˜¯åŸºäº NumPy çš„ä¸€ä¸ªå¼ºå¤§æ•°æ®åˆ†æä¸å¤„ç†åº“ã€‚å®ƒæä¾›äº†ä¸¤ä¸ªæ ¸å¿ƒæ•°æ®ç»“æ„ï¼š

- **Series**ï¼šä¸€ç»´å¸¦æ ‡ç­¾çš„æ•°ç»„ï¼ˆç±»ä¼¼å¸¦ç´¢å¼•çš„ä¸€åˆ—æ•°æ®ï¼‰
- **DataFrame**ï¼šäºŒç»´è¡¨æ ¼å‹æ•°æ®ï¼ˆç±»ä¼¼ Excel è¡¨æ ¼ / SQL è¡¨ï¼‰

Pandas åœ¨æ•°æ®æ¸…æ´—ã€åˆ†æã€ç‰¹å¾å·¥ç¨‹ã€é‡‘èå»ºæ¨¡ç­‰é¢†åŸŸåº”ç”¨å¹¿æ³›ï¼Œæ˜¯ Python æ•°æ®ç§‘å­¦ä¸æœºå™¨å­¦ä¹ çš„æ ¸å¿ƒåº“ä¹‹ä¸€ã€‚

ç‰¹ç‚¹åŒ…æ‹¬ï¼š

- **é«˜æ•ˆçš„æ•°æ®ç»“æ„**ï¼šSeries å’Œ DataFrame åŸºäº NumPyï¼Œæ”¯æŒé«˜æ•ˆå­˜å‚¨ä¸è®¡ç®—
- **çµæ´»çš„æ•°æ®ç´¢å¼•ä¸åˆ‡ç‰‡**ï¼šæ”¯æŒæŒ‰æ ‡ç­¾ï¼ˆlabelï¼‰ã€ä½ç½®ï¼ˆpositionï¼‰è®¿é—®æ•°æ®
- **ä¸°å¯Œçš„æ•°æ®æ“ä½œ**ï¼šåˆ†ç»„ï¼ˆgroupbyï¼‰ã€èšåˆï¼ˆaggregateï¼‰ã€é€è§†è¡¨ï¼ˆpivot_tableï¼‰ç­‰
- **æ•°æ®æ¸…æ´—ä¸å¤„ç†**ï¼šç¼ºå¤±å€¼å¤„ç†ã€æ•°æ®ç±»å‹è½¬æ¢ã€å­—ç¬¦ä¸²ä¸æ—¶é—´åºåˆ—å¤„ç†
- **æ–‡ä»¶è¯»å†™èƒ½åŠ›**ï¼šæ”¯æŒ CSVã€Excelã€SQLã€JSON ç­‰å¤šç§æ ¼å¼çš„é«˜æ•ˆè¯»å†™
- **ä¸å…¶ä»–ç§‘å­¦è®¡ç®—åº“å…¼å®¹**ï¼šå¯ä¸ NumPyã€Matplotlibã€Scikit-learn ç­‰æ— ç¼ç»“åˆ

## ğŸ“Œ Pandas å¸¸ç”¨æ–¹æ³•ï¼ˆæ–¹æ³•ç­¾å + å‚æ•°è§£é‡Šï¼‰

### åˆ›å»ºå¯¹è±¡

- `pd.Series(data=None, index=None, dtype=None, name=None, copy=False)`
   â†’ åˆ›å»ºä¸€ç»´æ•°ç»„ç»“æ„ã€‚
  - `data`ï¼šæ•°æ®ï¼Œå¯ä¸ºlist/ndarray/dictç­‰
  - `index`ï¼šç´¢å¼•æ ‡ç­¾
  - `dtype`ï¼šæ•°æ®ç±»å‹
  - `name`ï¼šSeries åç§°
  - `copy`ï¼šæ˜¯å¦å¤åˆ¶æ•°æ®
- `pd.DataFrame(data=None, index=None, columns=None, dtype=None, copy=False)`
   â†’ åˆ›å»ºäºŒç»´è¡¨æ ¼ç»“æ„ã€‚
  - `data`ï¼šäºŒç»´æ•°æ®ï¼ˆdict/ndarrayç­‰ï¼‰
  - `index`ï¼šè¡Œç´¢å¼•
  - `columns`ï¼šåˆ—ç´¢å¼•
  - `dtype`ï¼šæ•°æ®ç±»å‹

------

### æŸ¥çœ‹ä¿¡æ¯

- `df.head(n=5)`
   â†’ è¿”å›å‰ n è¡Œã€‚
- `df.tail(n=5)`
   â†’ è¿”å›å n è¡Œã€‚
- `df.info(verbose=None, buf=None, max_cols=None, memory_usage=None, show_counts=None)`
   â†’ æ˜¾ç¤ºæ•°æ®è¡¨æ¦‚å†µã€‚
- `df.describe(percentiles=None, include=None, exclude=None, datetime_is_numeric=False)`
   â†’ ç”Ÿæˆæ•°å€¼å‹åˆ—çš„ç»Ÿè®¡ä¿¡æ¯ã€‚

------

### é€‰æ‹©ä¸åˆ‡ç‰‡

- `df.loc[row_indexer, col_indexer]`
   â†’ æŒ‰ **æ ‡ç­¾** é€‰æ‹©æ•°æ®ã€‚
- `df.iloc[row_indexer, col_indexer]`
   â†’ æŒ‰ **ä½ç½®** é€‰æ‹©æ•°æ®ã€‚
- `df.query(expr, inplace=False, **kwargs)`
   â†’ ç”¨è¡¨è¾¾å¼ç­›é€‰æ•°æ®ã€‚
  - `expr`ï¼šå­—ç¬¦ä¸²è¡¨è¾¾å¼ï¼ˆå¦‚ `"col > 3 & col < 10"`ï¼‰
  - `inplace`ï¼šæ˜¯å¦åŸåœ°ä¿®æ”¹

------

### å¢åˆ æ”¹

- `df.drop(labels=None, axis=0, index=None, columns=None, inplace=False)`
   â†’ åˆ é™¤è¡Œæˆ–åˆ—ã€‚
  - `labels`ï¼šè¦åˆ é™¤çš„è¡Œ/åˆ—å
  - `axis`ï¼š0=è¡Œ, 1=åˆ—
  - `inplace`ï¼šæ˜¯å¦åŸåœ°ä¿®æ”¹
- `df.rename(mapper=None, index=None, columns=None, inplace=False)`
   â†’ é‡å‘½åè¡Œ/åˆ—ã€‚
  - `columns`ï¼šå­—å…¸ï¼Œæ—§åˆ—åâ†’æ–°åˆ—å
  - `inplace`ï¼šæ˜¯å¦åŸåœ°ä¿®æ”¹

------

### ç¼ºå¤±å€¼å¤„ç†

- `df.isnull()`
   â†’ è¿”å›å¸ƒå°”å€¼ DataFrameï¼Œæ ‡è®°ç¼ºå¤±å€¼ã€‚
- `df.fillna(value=None, method=None, inplace=False, limit=None)`
   â†’ å¡«å……ç¼ºå¤±å€¼ã€‚
  - `value`ï¼šå¡«å……å€¼
  - `method`ï¼šå¡«å……æ–¹å¼ï¼ˆ'ffill' å‘å‰å¡«å……, 'bfill' å‘åå¡«å……ï¼‰
- `df.dropna(axis=0, how='any', inplace=False)`
   â†’ åˆ é™¤å«ç¼ºå¤±å€¼çš„è¡Œ/åˆ—ã€‚
  - `axis`ï¼š0=è¡Œ, 1=åˆ—
  - `how`ï¼š'any'=ä»»æ„NaNåˆ é™¤, 'all'=å…¨NaNåˆ é™¤

------

### é‡å¤å€¼å¤„ç†

- `df.duplicated(subset=None, keep='first')`
   â†’ è¿”å›å¸ƒå°”Seriesï¼Œæ ‡è®°é‡å¤è¡Œã€‚
- `df.drop_duplicates(subset=None, keep='first', inplace=False)`
   â†’ åˆ é™¤é‡å¤è¡Œã€‚
  - `subset`ï¼šæŒ‡å®šæ£€æŸ¥çš„åˆ—
  - `keep`ï¼šä¿ç•™å“ªä¸€ä¸ªï¼ˆ'first' / 'last' / False å…¨åˆ ï¼‰

------

### åˆ†ç»„ä¸èšåˆ

- `df.groupby(by=None, axis=0, as_index=True)`
   â†’ åˆ†ç»„å¯¹è±¡ã€‚
  - `by`ï¼šåˆ—å/å‡½æ•°/æ•°ç»„
  - `as_index`ï¼šæ˜¯å¦è¿”å›ç´¢å¼•ä¸ºåˆ†ç»„é”®
- `grouped.agg(func=None, *args, **kwargs)`
   â†’ å¤šå‡½æ•°èšåˆã€‚

------

### æ’åº

- `df.sort_values(by, axis=0, ascending=True, inplace=False)`
   â†’ æŒ‰åˆ—å€¼æ’åºã€‚
  - `by`ï¼šåˆ—å
  - `ascending`ï¼šæ˜¯å¦å‡åº
- `df.sort_index(axis=0, ascending=True, inplace=False)`
   â†’ æŒ‰ç´¢å¼•æ’åºã€‚

------

### åˆå¹¶æ‹¼æ¥

- `pd.concat(objs, axis=0, join='outer', ignore_index=False)`
   â†’ æ²¿æŸç»´æ‹¼æ¥å¯¹è±¡ã€‚
  - `objs`ï¼šåˆ—è¡¨/å­—å…¸
  - `axis`ï¼š0=çºµå‘, 1=æ¨ªå‘
- `pd.merge(left, right, how='inner', on=None, left_on=None, right_on=None)`
   â†’ ç±»ä¼¼SQL joinçš„åˆå¹¶ã€‚
  - `how`ï¼š'inner' / 'outer' / 'left' / 'right'
  - `on`ï¼šå…¬å…±åˆ—

------

### è¾“å…¥è¾“å‡º

- `pd.read_csv(filepath, sep=',', header='infer', encoding=None)`
   â†’ ä» CSV æ–‡ä»¶è¯»å–æ•°æ®ã€‚
- `df.to_csv(path, sep=',', index=True, encoding='utf-8')`
   â†’ ä¿å­˜ä¸º CSVã€‚
- `pd.read_excel(io, sheet_name=0)`
   â†’ è¯»å– Excelã€‚
- `df.to_excel(excel_writer, sheet_name='Sheet1', index=True)`
   â†’ ä¿å­˜ä¸º Excelã€‚

## pandas ä¸»è¦æ–¹æ³•ä¸åŠŸèƒ½ç¤ºä¾‹

åœ¨ä½¿ç”¨pandasä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿å·²ç»`import`

```python
import numpy as np
import pandas as pd
```

------

### 1. pandas è®¤è¯†ï¼šSeries ä¸ DataFrame

#### 1.1 Series

```python
# ç”¨åˆ—è¡¨åˆ›å»º Seriesï¼ˆå¸¦é»˜è®¤ç´¢å¼• 0,1,2...ï¼‰
s = pd.Series([10, 20, 30, 40])
print(s)
# è¾“å‡ºï¼š
# 0    10
# 1    20
# 2    30
# 3    40
# dtype: int64

# ç”¨è‡ªå®šä¹‰ç´¢å¼•
s2 = pd.Series([1, 2, 3], index=['a', 'b', 'c'])
print(s2['a'])  # è¾“å‡ºï¼š1
print(s2.loc['b'])  # è¾“å‡ºï¼š2
print(s2.iloc[1])  # è¾“å‡ºï¼š2

# ä» numpy æ•°ç»„åˆ›å»º Seriesï¼ˆå…±äº«åº•å±‚æ•°æ®ï¼‰
arr = np.array([5, 6, 7])
s3 = pd.Series(arr)
print(s3)
# ä¿®æ”¹åŸæ•°ç»„ä¹Ÿå½±å“ Series
arr[1] = 100
print(s3)
```

#### 1.2 ç”¨å­—å…¸åˆ›å»º Series

```python
d = {'name': 'å¼ ä¸‰', 'age': 18, 'sex': 'ç”·'}
s_dict = pd.Series(d)
print(s_dict)
# è¾“å‡ºï¼š
# name    å¼ ä¸‰
# age       18
# sex       ç”·
# dtype: object
```

------

### 2. DataFrame

```python
# ç”¨å­—å…¸åˆ›å»º DataFrameï¼ˆæ¯ä¸ªé”®å¯¹åº”ä¸€åˆ—ï¼‰
df = pd.DataFrame({
    'name': ['Alice', 'Bob', 'Charlie'],
    'age': [25, 30, 35],
    'score': [88.5, 92.0, 85.0]
})
print(df)
# è¾“å‡ºï¼š
#       name  age  score
# 0    Alice   25   88.5
# 1      Bob   30   92.0
# 2  Charlie   35   85.0

# æŸ¥çœ‹å±æ€§
print(df.shape)       # è¾“å‡ºï¼š(3, 3)
print(df.columns)     # è¾“å‡ºï¼šIndex(['name', 'age', 'score'], dtype='object')
print(df.index)       # è¾“å‡ºï¼šRangeIndex(start=0, stop=3, step=1)
print(df.dtypes)      # è¾“å‡ºæ¯åˆ—çš„æ•°æ®ç±»å‹

# è®¿é—®åˆ—ä¸è¡Œ
print(df['name'])        # è¿™ä¼šè¿”å›ä¸€ä¸ª Series
print(df.loc[1])         # ç¬¬ 1 è¡Œæ•°æ®ï¼ˆæ ‡ç­¾ä½ç½®ï¼‰
print(df.iloc[0:2, 0:2])  # ç”¨ä½ç½®åˆ‡ç‰‡ï¼šå‰ä¸¤è¡Œï¼Œå‰ä¸¤åˆ—
```

------

### 3. åŸºæœ¬æ“ä½œï¼šå¢ã€åˆ ã€æ”¹ã€æŸ¥

```python
# æ–°å¢åˆ—
df['newcol'] = df['age'] * 2
print(df)

# åˆ é™¤åˆ—
df2 = df.drop(columns=['newcol'])
print(df2)

# ä¿®æ”¹å€¼
df.at[1, 'age'] = 31
print(df.loc[1])

# æ¡ä»¶è¿‡æ»¤ / å¸ƒå°”ç´¢å¼•
df_filtered = df[df['score'] > 90]
print(df_filtered)
```

------

### 4. ç¼ºå¤±å€¼ & é‡å¤å€¼å¤„ç†

```python
# æ„é€ å¸¦ NaN çš„ DataFrame
df_missing = pd.DataFrame({
    'A': [1, np.nan, 3],
    'B': [4, 5, np.nan]
})
print(df_missing)

# æ£€æŸ¥ç¼ºå¤±å€¼
print(df_missing.isnull())
print(df_missing.isnull().sum())

# å¡«å……ç¼ºå¤±å€¼
df_fill0 = df_missing.fillna(0)
print(df_fill0)

# åˆ é™¤å«ç¼ºå¤±å€¼çš„è¡Œ/åˆ—
df_drop = df_missing.dropna(axis=0)  # åˆ é™¤è¡Œ
print(df_drop)
```

------

### 5. åˆ†ç»„ä¸èšåˆï¼ˆGroupByï¼‰

```python
# ç¤ºä¾‹ DataFrame
df3 = pd.DataFrame({
    'key': ['A', 'B', 'A', 'B'],
    'value': [10, 20, 15, 25]
})

grouped = df3.groupby('key')
print(grouped.sum())
# è¾“å‡ºï¼š
#      value
# key       
# A        25
# B        45

print(grouped['value'].mean())
# è¾“å‡ºå¹³å‡å€¼
```

------

### 6. åˆå¹¶ / è¿æ¥ / æ‹¼æ¥

```python
df1 = pd.DataFrame({'id': [1,2,3], 'x': ['a','b','c']})
df2 = pd.DataFrame({'id': [2,3,4], 'y': [20, 30, 40]})

# å†…è¿æ¥ï¼ˆç±»ä¼¼ SQL çš„ inner joinï¼‰
df_join = pd.merge(df1, df2, on='id', how='inner')
print(df_join)

# å¤–è¿æ¥
df_outer = pd.merge(df1, df2, on='id', how='outer')
print(df_outer)

# æ‹¼æ¥ï¼ˆä¸Šä¸‹ / å·¦å³æ–¹å‘ï¼‰
df_vert = pd.concat([df1, df2], axis=0, ignore_index=True)
print(df_vert)

df_horiz = pd.concat([df1, df2], axis=1)
print(df_horiz)
```

------

### 7. æ—¶é—´åºåˆ—æ“ä½œï¼ˆç®€è¦ï¼‰

```python
dates = pd.date_range('2025-01-01', periods=6, freq='D')
df_ts = pd.DataFrame({
    'date': dates,
    'value': [10, 12, 11, 15, 14, 13]
})
df_ts = df_ts.set_index('date')
print(df_ts)

# é‡é‡‡æ · / æ»šåŠ¨çª—å£
print(df_ts.resample('2D').mean())   # æ¯ä¸¤å¤©å–å¹³å‡
print(df_ts.rolling(window=3).mean())  # æ»‘åŠ¨çª—å£å‡å€¼
```

------

### 8. è¯»å– / å­˜å‚¨æ•°æ®

```python
# è¯»å– CSV
df_csv = pd.read_csv('data.csv')
# å†™å…¥ CSV
df_csv.to_csv('out.csv', index=False)

# è¯»å– Excel
# df_excel = pd.read_excel('data.xlsx', sheet_name='Sheet1')
# å†™å…¥ Excel
# df_excel.to_excel('out.xlsx', index=False)

# è¯»å– / å†™å…¥ JSON
# df_json = pd.read_json('data.json')
# df_csv.to_json('out.json')
```