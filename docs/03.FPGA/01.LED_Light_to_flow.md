---
title: FPGA 01.一次最小的FPGA工程构建-从闪烁到流水
date: 2026-02-04 14:00:00
permalink: /pages/FPGA_01/
---

本文记录了在紫光 PGC4KD FPGA 上，从 LED 闪烁到流水灯的最小工程实践与思考，主要用于个人工程理解的固化，而非教程说明。

## 一、核心认识

在FPGA里面，延时≠sleep，而是“计数器+阈值+状态反转”，这意味着，FPGA 中所有“时间行为”最终都会被离散为时钟驱动下的状态变化。

LED的闪烁，本质上是给一个引脚赋值0或者1也可以给一排LED同时赋值0或1

流水灯的本质，其实就是一个循环的移位寄存器，先赋值LED=8b00000001，再进行左移位，当1位于LED[7]处时，下一次它就会出现在LED[0]处，这种表达方式在之后的状态机、数据通路设计中会频繁出现。

## 二、可复用的代码

```verilog
`timescale 1ns / 1ps

// LED循环流水灯（8位、0.5s切换、循环右移）- 可直接复用
module led_flow (
    input        clk,    // 输入时钟
    input        rstn,   // 低电平有效复位
    output [7:0] led     // 8位LED输出
);

// 可配置参数：适配不同板子时钟/流水间隔
parameter CLK_FREQ  = 50_000_000;  // 板载时钟频率（50MHz）
parameter FLOW_DELAY = 25_000_000; // 流水切换间隔计数（对应0.5s = FLOW_DELAY/CLK_FREQ）

// 内部寄存器
reg [25:0] cnt;        // 分频计数器（满足50MHz/0.5s的计数宽度需求）
reg [7:0]  led_status; // LED状态寄存器

// 步骤1：分频计数器（计数到FLOW_DELAY-1清零）
always @(posedge clk) begin
    if (!rstn)
        cnt <= 26'd0;
    else if (cnt == FLOW_DELAY - 1)
        cnt <= 26'd0;
    else
        cnt <= cnt + 1'b1;
end

// 步骤2：LED循环流水逻辑（计数满则切换状态，循环右移）
always @(posedge clk) begin
    if (!rstn)
        led_status <= 8'b0000_0001; // 复位后初始状态：最低位LED亮
    else if (cnt == FLOW_DELAY - 1)
        led_status <= {led_status[6:0], led_status[7]}; // 循环右移拼接（低7位移高位，原最高位移最低位）
end

// 输出赋值
assign led = led_status;

endmodule
```

## 三、工程习惯记述

1. 一般情况下，模块名需要和文件名称保持一致，这样方便集成环境识别顶层模块
2. 文件后缀".fdc"是约束文件，里面存储着时钟以及管脚约束等，是图形操作逻辑的底层，如果把一个.fdc文件放到指定位置，那么就不需要再重新约束
3. 不要在 FPGA 项目中使用 `#1` 等仿真延时语句，它们对综合电路没有实际意义

## 四、总结

在更高层次抽象下，这类实验并不关心具体外设，而是在练习：
**如何在时钟驱动下，对状态进行可控、可预测的转换。**

