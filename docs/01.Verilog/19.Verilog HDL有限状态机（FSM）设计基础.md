---
title: 19.Verilog HDL有限状态机（FSM）设计基础
date: 2025-08-13 15:40:00
permalink: /pages/Verilog_19/
---

# **有限状态机（FSM）：数字电路的“大脑”**

## **1. FSM 类型对比**

| 类型        | 输出依赖            | 特点                             |
| ----------- | ------------------- | -------------------------------- |
| **Moore机** | 仅当前状态          | 输出稳定，无延迟毛刺             |
| **Mealy机** | 当前状态 + 当前输入 | 响应快，但可能带毛刺（输出跳变） |

> Moore机输出只看状态，Mealy机输出对输入敏感，速度快但要注意毛刺问题。

---

## **2. 状态编码方式**

选择合适的状态编码对面积、速度、设计复杂度影响大：

| 编码方式   | 触发器数量 | 优势                 |
| ---------- | ---------- | -------------------- |
| **二进制** | `log2(N)`  | 占用面积小，资源节约 |
| **独热码** | `N`        | 速度快，组合逻辑简单 |
| **格雷码** | `log2(N)`  | 状态切换无毛刺       |

> 独热码用触发器多，但状态跳变只改变一位，适合高速设计。  
> 格雷码的状态切换避免多位同时跳变，减少毛刺。

---

## **3. 三段式设计模板**

设计FSM通常分成三步：

1. **状态寄存器**：用时钟更新当前状态。  
2. **下一状态逻辑**：组合逻辑，根据当前状态和输入计算下一状态。  
3. **输出逻辑**：根据当前状态（Moore）或状态+输入（Mealy）产生输出。

---

### **Verilog 典型模板示例（Moore机）**

```verilog
module fsm_example (
    input  wire clk,
    input  wire rst_n,
    input  wire in,
    output reg  out
);

    // 状态定义（可用枚举）
    typedef enum logic [1:0] {
        S0 = 2'b00,
        S1 = 2'b01,
        S2 = 2'b10
    } state_t;

    state_t current_state, next_state;

    // 1. 状态寄存器更新
    always @(posedge clk or negedge rst_n) begin
        if (!rst_n)
            current_state <= S0;
        else
            current_state <= next_state;
    end

    // 2. 下一状态逻辑
    always @(*) begin
        case (current_state)
            S0: next_state = in ? S1 : S0;
            S1: next_state = in ? S2 : S0;
            S2: next_state = S0;
            default: next_state = S0;
        endcase
    end

    // 3. 输出逻辑（Moore机，输出只和状态相关）
    always @(*) begin
        out = 1'b0;
        if (current_state == S2)
            out = 1'b1;
    end

endmodule
```

## **4. 小结**

- FSM 是数字电路的核心“大脑”，负责状态管理和控制流程。
- Moore机输出稳定、设计简单；Mealy机响应快，但要注意毛刺。
- 状态编码选择直接影响设计效率和性能。
- 三段式设计模板是业界常用的高效设计模式。

> 设计FSM就像搭积木：状态寄存器是基础，下一状态是桥梁，输出逻辑是点睛。