---
title: 03.Verilog HDL运算符和表达式
date: 2025-07-19 08:00:49
permalink: /pages/Verilog_03/
---

# 运算符和表达式

## **1、算术运算符：加减乘除**

**符号**：`+`、`-`、`*`、`/`、`%`（取模）
**作用**：数学运算，**注意位宽规则**！

```verilog
module arithmetic;
  reg [3:0] a = 4'b1100; // 12
  reg [2:0] b = 3'b011;  // 3
  
  initial begin
    $display("a + b = %b", a + b); // 12+3=15 → 4'b1111
    $display("a - b = %b", a - b); // 12-3=9 → 4'b1001
    $display("a * b = %b", a * b); // 12*3=36 → 但a只有4位，截断后=4'b0100（36%16=4）
    $display("a / b = %b", a / b); // 12/3=4 → 4'b0100
    $display("a %% b = %b", a % b); // 12%3=0 → 4'b0000
  end
endmodule
```

- 结果位宽 = 操作数的最大位宽（如4位+3位=4位结果）。
- 除法/取模会**舍去小数**（如 `7/3=2`）

## **2. 关系运算符：比较大小**

**符号**：`>`、`<`、`>=`、`<=`
**输出**：1（真）、0（假）、x（未知）

```verilog
module compare;
  reg [3:0] x = 4'b1010; // 10
  reg [3:0] y = 4'b0011; // 3
  
  initial begin
    $display("x > y? %b", x > y);  // 10>3 → 1
    $display("x < y? %b", x < y);  // 10<3 → 0
    $display("x >=10? %b", x >= 4'd10); // 10>=10 → 1
  end
endmodule
```

**注意**：若操作数含 `x`，结果可能是 `x`（如 `4'b101x > 4'b0000` → `x`）。

## **3. 相等运算符：判等**

**符号**：

- `==`（等于）、`!=`（不等）→ 可能返回 `x`
- `===`（全等）、`!==`（非全等）→ 严格比较（包括 `x` 和 `z`）

```verilog
module equality;
  reg [3:0] p = 4'b101x;
  reg [3:0] q = 4'b1010;
  
  initial begin
    $display("p == q? %b", p == q);  // 101x == 1010 → x（不确定）
    $display("p === q? %b", p === q); // 101x === 1010 → 0（严格不等）
    $display("p != q? %b", p != q);  // 101x != 1010 → x
    $display("p !== q? %b", p !== q); // 101x !== 1010 → 1（确实不等）
  end
endmodule
```

**何时用 `===`？** 测试中精确匹配高阻态 `z` 或未知态 `x`。

## **4. 逻辑运算符：真/假判断**

**符号**：`&&`（与）、`||`（或）、`!`（非）
**规则**：非0即真（`0`=假，`1`/`x`/`z`=真）

```verilog
module logical;
  reg a = 1'b1;
  reg b = 1'b0;
  reg c = 1'bx;
  
  initial begin
    $display("a && b = %b", a && b); // 1 && 0 → 0
    $display("a || b = %b", a || b); // 1 || 0 → 1
    $display("!a = %b", !a);         // !1 → 0
    $display("a && c = %b", a && c); // 1 && x → x（不确定）
  end
endmodule
```

**易错点**：逻辑运算符会**先化简操作数为1位**（如 `4'b1011` 当作 `1'b1`）。

------

## **5. 按位运算符：逐bit操作**

**符号**：`&`（与）、`|`（或）、`^`（异或）、`~`（非）

```verilog
module bitwise;
  reg [3:0] m = 4'b1100;
  reg [3:0] n = 4'b1010;
  
  initial begin
    $display("m & n = %b", m & n); // 1100 & 1010 → 1000
    $display("m | n = %b", m | n); // 1100 | 1010 → 1110
    $display("m ^ n = %b", m ^ n); // 1100 ^ 1010 → 0110（相同为0，不同为1）
    $display("~m = %b", ~m);       // ~1100 → 0011
  end
endmodule
```

**对比逻辑运算符**：

- `&` 是逐位与，`&&` 是整体逻辑与。
- 示例：`4'b1100 && 4'b1010 → 1`（非0即真），但 `4'b1100 & 4'b1010 → 4'b1000`。

------

## **6. 移位运算符：左移/右移**

**符号**：`<<`（左移）、`>>`（右移）
**规则**：空位补 `0`，**不循环移位**！

```verilog
module shift;
  reg [3:0] num = 4'b1101; // 13
  
  initial begin
    $display("num << 1 = %b", num << 1); // 1101→1010（高位1丢弃，低位补0）
    $display("num >> 2 = %b", num >> 2); // 1101→0011（低位01丢弃，高位补0）
  end
endmodule
```

**应用场景**：

- 左移1位 ≈ 乘以2（`4'b0011<<1 → 4'b0110`，即3→6）。
- 右移2位 ≈ 除以4（`4'b1100>>2 → 4'b0011`，即12→3）。

------

## **7. 条件运算符：简化的if-else**

**符号**：`条件 ? 表达式1 : 表达式2`

```verilog
module conditional;
  reg sel = 1'b1;
  reg [3:0] in1 = 4'b1010;
  reg [3:0] in2 = 4'b0101;
  wire [3:0] out;
  
  assign out = sel ? in1 : in2; // sel为1选in1，否则选in2
  
  initial begin
    $display("out = %b", out); // sel=1 → out=1010
  end
endmodule
```

**等效代码**：

```verilog
if (sel) out = in1;
else out = in2;
```

------

## **8. 连接与复制运算符：合并信号**

**符号**：

- 连接 `{a, b}`：将多个信号拼接。
- 复制 `{n{a}}`：重复信号n次。

```verilog
module concat;
  reg [1:0] a = 2'b10;
  reg [2:0] b = 3'b110;
  
  initial begin
    $display("{a, b} = %b", {a, b}); // 10 + 110 → 5'b10110
    $display("{3{a}} = %b", {3{a}}); // 10重复3次 → 6'b101010
    $display("{2{a}, 1'b0, b} = %b", {2{a}, 1'b0, b}); // 1010 + 0 + 110 → 7'b1010110
  end
endmodule
```

**典型用途**：

- 扩展位宽：`{4{1'b1}}` 生成 `4'b1111`。
- 组合总线：`{addr, data}` 合并地址和数据。

### **总结：运算符优先级表**

| 优先级 | 运算符                    | 描述                                       |        |      |
| :----- | :------------------------ | :----------------------------------------- | ------ | ---- |
| 最高   | `!` `~`                   | 逻辑非、按位非                             |        |      |
|        | `*` `/` `%`               | 乘、除、取模                               |        |      |
|        | `+` `-`                   | 加、减                                     |        |      |
|        | `<<` `>>`                 | 移位                                       |        |      |
|        | `<` `<=` `>` `>=`         | 关系比较                                   |        |      |
|        | `==` `!=` `===` `!==`     | 相等判断                                   |        |      |
|        | `&`                       | 按位与                                     |        |      |
|        | `^` `^~`                  | 按位异或、同或                             |        |      |
|        | `                     | ` | 按位或                                     |        |      |
|        | `&&`                      | 逻辑与                                     |        |      |
|        | 最低                      | `                     |                | ` | 逻辑或 |      |

**黄金法则**：

1. 不确定优先级时，**加括号**！如 `(a & b) || c`。
2. 按位操作 vs 逻辑操作：看是否需要逐bit处理。
3. 移位运算的空位永远补 `0`。