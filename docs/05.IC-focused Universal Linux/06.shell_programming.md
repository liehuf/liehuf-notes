---
title: 06.Shell编程
date: 2026-02-22 14:00:00
permalink: /pages/Linux_06/
---

### 一、 Shell脚本结构

#### 核心三要素：shebang + 执行权限 + 参数传递

##### （1）Shebang（脚本的 “身份证”）

- **定义**：脚本第一行的 `#!/bin/bash`（或 `#!/bin/sh`），告诉系统 “用哪个 Shell 来执行这个脚本”；
- **必须写在第一行**，且 `#!` 是固定开头（少一个都不行）；
- 常见写法：
  - `#!/bin/bash`：用 bash 执行（Ubuntu 默认，功能最全）；
  - `#!/bin/sh`：用系统默认 Shell（Ubuntu 中 `sh` 是 bash 的软链接）。

##### （2）执行权限

- Shell 脚本本质是 “可执行文本文件”，必须赋予**执行权限（x）** 才能运行；
- 核心命令：`chmod +x 脚本名.sh`（给所有用户执行权限）；
- 执行方式：
  - `./脚本名.sh`：在当前 Shell 子进程中执行（推荐）；
  - `bash 脚本名.sh`：强制用 bash 执行（无需执行权限）；
  - `. 脚本名.sh` / `source 脚本名.sh`：在当前 Shell 中执行（会修改当前环境）。

##### （3）参数传递（脚本接收外部输入）

脚本运行时，通过位置参数接收外部传入的参数：

- `$0`：脚本本身的名字；
- `$1`：第一个参数，`$2`：第二个参数，…，`$9`：第九个参数；
- `$*` / `$@`：所有参数（细节差异：`$*` 把所有参数当一个字符串，`$@` 保留每个参数独立）；
- `$#`：参数的个数。

```bash
#如下是一个示例，展示在Linux系统中创建一个脚本、赋予执行权限并执行然后输出的过程

nano first_script.sh # 创建脚本文件

# 编辑脚本内容
#!/bin/bash
# 这是注释：第一个Shell脚本，接收参数并打印
# 打印脚本名
echo "脚本名：$0"
# 打印第一个参数
echo "第一个参数：$1"
# 打印第二个参数
echo "第二个参数：$2"
# 打印所有参数
echo "所有参数：$@"
# 打印参数个数
echo "参数个数：$#"

chmod +x first_script.sh # 赋予执行权限

./first_script.sh hello world # 执行

#输出内容
脚本名：./first_script.sh
第一个参数：hello
第二个参数：world
所有参数：hello world
参数个数：2

# 也可以使用以下方式执行
# 方式1：用bash强制执行（无需执行权限）
bash first_script.sh test1 test2

# 方式2：在当前Shell执行（会修改当前环境，慎用）
source first_script.sh test3 test4
# 或 . first_script.sh test3 test4
```

### 二、条件判断(if)

#### 基本语法

```bash
# 单分支
if 条件; then
    命令
fi

# 多分支
if 条件1; then
    命令1
elif 条件2; then
    命令2
else
    命令3
fi
```

#### 常用例子

1. 判断命令是否成功（最常用）

```bash
if cp a b; then
    echo "成功"
else
    echo "失败"
fi
```

命令返回值：

- `0`：成功
- 非 `0`：失败

------

2. 文件判断参数

| 参数      | 含义     |
| --------- | -------- |
| `-e file` | 文件存在 |
| `-f file` | 普通文件 |
| `-d dir`  | 目录     |

示例：

```bash
if [ -d backup ]; then
    echo "目录存在"
fi
```

⚠️ `[ ]` 前后必须有空格

------

 	3. 数值 / 字符串比较

```bash
if [ "$a" -eq 10 ]; then
    echo "a 等于 10"
fi
```

常用参数：

| 参数  |    含义    |
| :---: | :--------: |
| `-eq` | 等于(数字) |
| `-ne` |   不等于   |
| `-gt` |    大于    |
| `-lt` |    小于    |
| `==`  | 字符串相等 |
| `!=`  | 字符串不等 |

### 三、循环

#### for循环

##### 基本语法

```bash
for 变量 in 列表; do
    命令
done
```

##### 常见用法

遍历文件：

```bash
for file in *.txt; do
    echo "$file"
done
```

遍历数字：

```bash
for i in {1..5}; do
    echo $i
done
```

------

#### while 循环

##### 基本语法

```bash
while 条件; do
    命令
done
```

##### 常见用法

无限循环：

```bash
while true; do
    sleep 1
done
```

按行读文件：

```bash
while read line; do
    echo "$line"
done < file.txt
```

### 四、函数

#### 基本语法

```bash
函数名() {
    命令
}
```

调用：

```bash
函数名
```

------

#### 带参数的函数

```bash
log() {
    echo "$1"
}
```

调用：

```bash
log "开始执行"
```

参数说明：

- `$1` `$2`：第 1、2 个参数
- `$@`：所有参数

------

#### 返回值（可选）

```bash
myfunc() {
    return 0
}
```

- 返回范围：0–255
- 默认返回最后一条命令的结果

### 五、定时任务 cron（时间触发器）

cron 是 Linux 内置的定时任务机制，用来在**指定时间自动执行命令或脚本**。  
本质只有一句话：**时间到了 → 执行一条命令**。

cron 做的事非常简单：

1. 读取定时规则
2. 到时间
3. 执行对应的命令或脚本

cron **不理解脚本逻辑**，只负责“按时触发”。

#### （1）cron 核心语法（定时规则）

- 规则格式（5 个字段，空格分隔）：`分 时 日 月 周 要执行的命令/脚本`；

- 字段取值：

  - 分：0-59；时：0-23；日：1-31；月：1-12；周：0-7（0/7 都是周日）；

  

- 特殊符号：

  - `*`：每一个（比如 `* * * * *` = 每分钟）；
  - `*/5`：每隔 5 个（比如 `*/5 * * * *` = 每 5 分钟）；
  - `1,30`：指定多个值（比如 `1,30 * * * *` = 每小时的 1 分和 30 分）。

#### （2）cron 操作命令

- 编辑定时任务：`crontab -e`（用户级）；`/etc/crontab`（系统级）；
- 查看定时任务：`crontab -l`；
- 删除定时任务：`crontab -r`（谨慎！）；
- 查看 cron 日志：`grep cron /var/log/syslog`（排查定时任务不执行问题）。

#### （3）核心注意事项

- 脚本必须写绝对路径（比如 `/home/ikun/backup.sh`，而非 `./backup.sh`）；
- 脚本中调用的命令最好写绝对路径（比如 `/bin/ls`，而非 `ls`）；
- 定时任务的输出默认发邮件，可重定向到日志：`*/5 * * * * /home/ikun/check.sh >> /home/ikun/check.log 2>&1`。