---
title: 06.网络通信
date: 2026-02-23 12:00:00
permalink: /pages/Linux_06/
---

## 网络 - 连接自己与世界

### 一、总框架

在 Linux 里谈“网络”，可以先记住一句总话：

> **网络 = 我是谁（IP）→ 我怎么走（路由）→ 我问谁（DNS）→ 我找的是谁（端口）**

下面四个概念，正好一一对应。

### 二、IP

**IP 是网络世界里的“逻辑地址”**，用来唯一标识一台设备在某个网络中的位置。

---

IP 配置里包含哪些东西？

一台机器“完整的网络身份”，至少包括：

1. **IP 地址**
   - 比如：`192.168.1.10`
2. **子网掩码**
   - 用来判断“谁算本地人”
3. **网关（Gateway）**
   - 出本地网络时的“出口”
4. **DNS**（**解析域名和IP地址）**

---

静态 IP vs 动态 IP

- **动态 IP（DHCP）**
  - 路由器自动分配
  - 常见于家用、学校网络
- **静态 IP**
  - 手动指定
  - 常见于服务器、固定设备

使用`ip addr`命令可以查询：

```bash
# 1: lo —— 回环接口（本机自己）
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN
# LOOPBACK：只能本机用
# mtu 65536：非常大，因为不走物理网络, mtu指最大传输单元，可理解为“集装箱的最大载重”，回环接口不经过外部硬件，所以值非常大

    link/loopback 00:00:00:00:00:00
    # 回环接口没有真实 MAC

    inet 127.0.0.1/8 scope host lo
    # IPv4 回环地址，只在本机有效

    inet6 ::1/128 scope host
    # IPv6 回环地址


# 2: ens33 —— 真正对外的网卡
2: ens33: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP
# UP：已启用
# LOWER_UP：物理/虚拟链路已连通
# mtu 1500：以太网标准 MTU

    link/ether 00:0c:29:52:80:b3
    # MAC 地址

    altname enp2s1
    # 同一网卡的另一种命名方式

    inet 192.168.60.128/24 brd 192.168.60.255 scope global dynamic
    # IPv4 地址
    # /24 = 子网掩码 255.255.255.0
    # dynamic = DHCP 分配的

    valid_lft 1660sec preferred_lft 1660sec
    # 租约剩余时间（DHCP）

    inet6 fe80::8806:a458:ce09:7873/64 scope link
    # IPv6 链路本地地址（自动生成，只在本网段有效）
```

### 三、路由

路由解决的问题是：

> **“这个目标 IP，我应该往哪个方向发？”**

你可以把它理解成一张表：

| 目标地址 | 下一跳   |
| -------- | -------- |
| 本地网段 | 直接发   |
| 其他地址 | 交给网关 |

默认路由：

> “如果我不知道怎么走，就走这条”

一般长这样（概念层面）：

```bash
0.0.0.0/0 → 网关
```

路由是“系统级决策”，路由不是某个应用决定的，是 **操作系统内核决定的**，所有程序共享同一套路由结果

所以一旦路由错了——毁灭吧！世gai(界)！

使用`ip route show`命令可以查询

```bash
# 执行的命令：ip route show (等价于 ip route)，作用是查看Linux系统的路由表
# 路由表决定了本机的网络数据包该从哪个网卡、走哪个网关发送到目标地址

# 第一行：默认路由（核心，所有外网访问都走这条）
default via 192.168.60.2 dev ens33 proto dhcp metric 100 
# default      → 表示这是默认路由，所有没有明确匹配的网络请求都走这条规则
# via 192.168.60.2 → 数据包要经过网关192.168.60.2转发（这是你路由器/虚拟机网关的IP）
# dev ens33     → 数据包从ens33网卡发出
# proto dhcp    → 这条路由规则是通过DHCP自动获取的（不是手动配置）
# metric 100    → 路由优先级，数字越小优先级越高（100是常规优先级）

# 第二行：APIPA私有网段路由（备用，几乎用不到）
169.254.0.0/16 dev ens33 scope link metric 1000 
# 169.254.0.0/16 → 这是Windows/Linux的自动私有地址段
# dev ens33      → 走ens33网卡
# scope link     → 仅在本地链路（本机所在局域网）生效
# metric 1000    → 优先级极低，只有其他路由失效时才会用
# 作用：当DHCP服务器故障、拿不到IP时，系统会自动分配这个网段的IP，仅用于同网段设备通信

# 第三行：本网段直连路由（局域网内通信规则）
192.168.60.0/24 dev ens33 proto kernel scope link src 192.168.60.128 metric 100 
# 192.168.60.0/24 → 匹配目标地址为192.168.60.x的数据包（你的局域网段）
# dev ens33       → 走ens33网卡
# proto kernel    → 这条规则是内核自动生成的（基于网卡的IP配置）
# scope link      → 仅在本地链路生效
# src 192.168.60.128 → 发送这类数据包时，使用本机IP 192.168.60.128作为源地址
# metric 100      → 优先级和默认路由一致
# 作用：访问同网段（192.168.60.x）的设备时，直接通过ens33网卡通信，不用经过网关
```

### 四、DNS

DNS 的作用只有一句话：

> **把“人类能记的名字”，翻译成“机器用的 IP”**

比如：

```bash
www.example.com → 93.184.216.34
```

在 Linux 中，DNS 是：一个配置，一组服务器地址被所有程序共享，包括浏览器、curl、apt、ssh

使用`resolvectl status`命令可以查询当前的DNS状态

```bash
ikun@ubuntu2004:~/Desktop$ resolvectl status
Global
       Protocols: -LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported
resolv.conf mode: stub

Link 2 (ens33)
    Current Scopes: DNS
         Protocols: +DefaultRoute +LLMNR -mDNS -DNSOverTLS DNSSEC=no/unsupported
Current DNS Server: 192.168.60.2
       DNS Servers: 192.168.60.2
        DNS Domain: localdomain
```

### 五、端口

端口的基本范围

- 0–65535
- 常见约定（不强制）：
  - 0–1023：系统 / 标准服务
  - 1024+：普通程序

IP 只能定位到“哪台机器”，
 但一台机器上有很多服务。

端口解决的是：

> **“我到底是来找你机器上的哪个服务？”**

IP + 端口 = 唯一通信目标

e.g. ：

```bash
192.168.1.10:22  → SSH
192.168.1.10:80  → HTTP
192.168.1.10:443 → HTTPS
```

没有端口，操作系统不知道把数据交给哪个程序

---

```bash
ikun@ubuntu2004:~/Desktop$ ss -tuln
Netid    State     Recv-Q    Send-Q       Local Address:Port        Peer Address:Port    Process    
udp      UNCONN    0         0                  0.0.0.0:5353             0.0.0.0:*                  
udp      UNCONN    0         0                  0.0.0.0:45081            0.0.0.0:*                  
udp      UNCONN    0         0            127.0.0.53%lo:53               0.0.0.0:*                  
udp      UNCONN    0         0                     [::]:5353                [::]:*                  
udp      UNCONN    0         0                     [::]:59078               [::]:*                  
tcp      LISTEN    0         128                0.0.0.0:22               0.0.0.0:*                  
tcp      LISTEN    0         4096         127.0.0.53%lo:53               0.0.0.0:*                  
tcp      LISTEN    0         128              127.0.0.1:631              0.0.0.0:*                  
tcp      LISTEN    0         128                  [::1]:631                 [::]:*                  
tcp      LISTEN    0         128                   [::]:22                  [::]:*       
```

`ss -tuln` 是 Linux 中用于查看**本机监听端口**的常用命令，各参数含义：

- `-t`：显示 TCP 端口
- `-u`：显示 UDP 端口
- `-l`：只看监听状态
- `-n`：用数字显示端口，不解析域名

从输出可以看出：

- 本机 **TCP 22 端口** 对外开放，用于 SSH 远程登录。
- **127.0.0.53:53** 是系统 DNS 解析服务，仅本地使用。
- **631 端口** 是本地打印机服务，不对外暴露。
- 其余 UDP 端口为系统 mDNS 及临时端口，均为正常系统服务。

整体端口状态正常，服务规范，无异常开放端口。