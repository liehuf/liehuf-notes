---
title: 16.日志
date: 2026-02-28 22:30:00
permalink: /pages/Linux_16/
---

## 一、日志与排错

在现代 Ubuntu（20.04+）里，**90% 的系统级问题**，都逃不出下面三样：

1. **journalctl** —— 系统与服务的“总账本”
2. **dmesg** —— 内核刚刚发生了什么
3. **日志定位思路** —— 先缩小范围，再精确击中

先把这三者在脑子里“分工清楚”。

------

## 二、journalctl：systemd 时代的核心武器

###  journalctl 是干什么的？

一句话：

> **journalctl = systemd 的统一日志查看器**

它把这些东西都收进来：

- 系统启动日志
- 各种 service（ssh、NetworkManager、cron…）
- 内核消息（部分）
- 用户态服务输出

 以后别人说“看日志”，**默认就是 journalctl**。

------

###  最常用、最值钱的用法（必须记住）

#### （1）查看所有日志（不常用，但知道就行）

```bash
journalctl
```

 日志很多，用 **↑ ↓ / PageUp / PageDown / q 退出**

------

#### （2）只看**最近的日志**（最常用）

```bash
journalctl -e
```

- `-e` = end，直接跳到最新
- **排错第一反应**

------

#### （3）实时跟踪日志（排查“正在发生的问题”）

```bash
journalctl -f
```

相当于 systemd 世界里的 `tail -f`

 **服务一启动就报错，用这个**

------

#### （4）按时间过滤（非常工程化）

```bash
journalctl --since "10 minutes ago"
journalctl --since today
journalctl --since "2026-02-27 20:00"
```

 日志太多时，这是救命招

------

#### （5）只看某个服务（极其重要）

```bash
journalctl -u ssh
journalctl -u NetworkManager
```

 思维模式要固定成：

> **哪个服务出问题 → 看哪个 service 的日志**

------

###  journalctl 输出怎么看？

典型一行日志长这样：

```bash
Feb 27 21:10:32 ubuntu systemd[1]: Failed to start xxx.service
```

拆开看：

- `Feb 27 21:10:32` → 时间
- `ubuntu` → 主机名
- `systemd[1]` → 谁发的
- `Failed to start xxx.service` → **真正有用的部分**

 **只抓“Failed / error / denied / timeout”这些词**

------

## 三、dmesg：内核刚刚“喊了什么”

###  dmesg 是什么？

一句话：

> **dmesg = 内核缓冲区里的即时消息**

它关注的是：

- 硬件
- 驱动
- 启动过程
- USB、磁盘、网卡、文件系统

系统层面的问题，先 dmesg，再 journalctl**

------

### 最常用的 dmesg 用法

#### （1）直接看（日志很多）

```bash
dmesg
```

一般不这么用。

------

#### （2）分页看（常用）

```bash
dmesg | less
```

------

#### （3）只看“错误级别”（非常有价值）

```bash
dmesg --level=err,warn
```

只留下：

- error
- warning

**这是排错时的黄金命令**

------

#### （4）硬件刚插拔时看

```bash
dmesg | tail
```

- 插 U 盘
- 插网卡
- 设备识别失败

------

## 四、日志定位：真正的工程思路（重点）

遇到问题，**不要乱翻日志**，按这个顺序来：

### 标准排错路径

#### ① 问题是“系统级”还是“服务级”？

- 系统起不来、设备不认 → **dmesg**
- ssh、网络、服务异常 → **journalctl**

------

#### ② 有没有明确的服务？

- 有 → `journalctl -u 服务名`
- 没有 → `journalctl -e`

------

#### ③ 问题是不是“刚刚发生”？

- 是 → `journalctl -f`
- 否 → `--since`

------

#### ④ 只盯关键词

- `failed`
- `error`
- `denied`
- `timeout`

📌 **别试图看懂所有日志，只抓“异常句子”**