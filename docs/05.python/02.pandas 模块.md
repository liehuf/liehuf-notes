---
title: 01.pandas 模块
date: 2025-09-26 22:30:00
permalink: /pages/Python_02/
---

# pandas 模块

## Pandas 简介

Pandas（来源于 *Panel Data*）是基于 NumPy 的一个强大数据分析与处理库。它提供了两个核心数据结构：

- **Series**：一维带标签的数组（类似带索引的一列数据）
- **DataFrame**：二维表格型数据（类似 Excel 表格 / SQL 表）

Pandas 在数据清洗、分析、特征工程、金融建模等领域应用广泛，是 Python 数据科学与机器学习的核心库之一。

特点包括：

- **高效的数据结构**：Series 和 DataFrame 基于 NumPy，支持高效存储与计算
- **灵活的数据索引与切片**：支持按标签（label）、位置（position）访问数据
- **丰富的数据操作**：分组（groupby）、聚合（aggregate）、透视表（pivot_table）等
- **数据清洗与处理**：缺失值处理、数据类型转换、字符串与时间序列处理
- **文件读写能力**：支持 CSV、Excel、SQL、JSON 等多种格式的高效读写
- **与其他科学计算库兼容**：可与 NumPy、Matplotlib、Scikit-learn 等无缝结合

## 📌 Pandas 常用方法（方法签名 + 参数解释）

### 创建对象

- `pd.Series(data=None, index=None, dtype=None, name=None, copy=False)`
   → 创建一维数组结构。
  - `data`：数据，可为list/ndarray/dict等
  - `index`：索引标签
  - `dtype`：数据类型
  - `name`：Series 名称
  - `copy`：是否复制数据
- `pd.DataFrame(data=None, index=None, columns=None, dtype=None, copy=False)`
   → 创建二维表格结构。
  - `data`：二维数据（dict/ndarray等）
  - `index`：行索引
  - `columns`：列索引
  - `dtype`：数据类型

------

### 查看信息

- `df.head(n=5)`
   → 返回前 n 行。
- `df.tail(n=5)`
   → 返回后 n 行。
- `df.info(verbose=None, buf=None, max_cols=None, memory_usage=None, show_counts=None)`
   → 显示数据表概况。
- `df.describe(percentiles=None, include=None, exclude=None, datetime_is_numeric=False)`
   → 生成数值型列的统计信息。

------

### 选择与切片

- `df.loc[row_indexer, col_indexer]`
   → 按 **标签** 选择数据。
- `df.iloc[row_indexer, col_indexer]`
   → 按 **位置** 选择数据。
- `df.query(expr, inplace=False, **kwargs)`
   → 用表达式筛选数据。
  - `expr`：字符串表达式（如 `"col > 3 & col < 10"`）
  - `inplace`：是否原地修改

------

### 增删改

- `df.drop(labels=None, axis=0, index=None, columns=None, inplace=False)`
   → 删除行或列。
  - `labels`：要删除的行/列名
  - `axis`：0=行, 1=列
  - `inplace`：是否原地修改
- `df.rename(mapper=None, index=None, columns=None, inplace=False)`
   → 重命名行/列。
  - `columns`：字典，旧列名→新列名
  - `inplace`：是否原地修改

------

### 缺失值处理

- `df.isnull()`
   → 返回布尔值 DataFrame，标记缺失值。
- `df.fillna(value=None, method=None, inplace=False, limit=None)`
   → 填充缺失值。
  - `value`：填充值
  - `method`：填充方式（'ffill' 向前填充, 'bfill' 向后填充）
- `df.dropna(axis=0, how='any', inplace=False)`
   → 删除含缺失值的行/列。
  - `axis`：0=行, 1=列
  - `how`：'any'=任意NaN删除, 'all'=全NaN删除

------

### 重复值处理

- `df.duplicated(subset=None, keep='first')`
   → 返回布尔Series，标记重复行。
- `df.drop_duplicates(subset=None, keep='first', inplace=False)`
   → 删除重复行。
  - `subset`：指定检查的列
  - `keep`：保留哪一个（'first' / 'last' / False 全删）

------

### 分组与聚合

- `df.groupby(by=None, axis=0, as_index=True)`
   → 分组对象。
  - `by`：列名/函数/数组
  - `as_index`：是否返回索引为分组键
- `grouped.agg(func=None, *args, **kwargs)`
   → 多函数聚合。

------

### 排序

- `df.sort_values(by, axis=0, ascending=True, inplace=False)`
   → 按列值排序。
  - `by`：列名
  - `ascending`：是否升序
- `df.sort_index(axis=0, ascending=True, inplace=False)`
   → 按索引排序。

------

### 合并拼接

- `pd.concat(objs, axis=0, join='outer', ignore_index=False)`
   → 沿某维拼接对象。
  - `objs`：列表/字典
  - `axis`：0=纵向, 1=横向
- `pd.merge(left, right, how='inner', on=None, left_on=None, right_on=None)`
   → 类似SQL join的合并。
  - `how`：'inner' / 'outer' / 'left' / 'right'
  - `on`：公共列

------

### 输入输出

- `pd.read_csv(filepath, sep=',', header='infer', encoding=None)`
   → 从 CSV 文件读取数据。
- `df.to_csv(path, sep=',', index=True, encoding='utf-8')`
   → 保存为 CSV。
- `pd.read_excel(io, sheet_name=0)`
   → 读取 Excel。
- `df.to_excel(excel_writer, sheet_name='Sheet1', index=True)`
   → 保存为 Excel。

## pandas 主要方法与功能示例

在使用pandas之前，需要确保已经`import`

```python
import numpy as np
import pandas as pd
```

------

### 1. pandas 认识：Series 与 DataFrame

#### 1.1 Series

```python
# 用列表创建 Series（带默认索引 0,1,2...）
s = pd.Series([10, 20, 30, 40])
print(s)
# 输出：
# 0    10
# 1    20
# 2    30
# 3    40
# dtype: int64

# 用自定义索引
s2 = pd.Series([1, 2, 3], index=['a', 'b', 'c'])
print(s2['a'])  # 输出：1
print(s2.loc['b'])  # 输出：2
print(s2.iloc[1])  # 输出：2

# 从 numpy 数组创建 Series（共享底层数据）
arr = np.array([5, 6, 7])
s3 = pd.Series(arr)
print(s3)
# 修改原数组也影响 Series
arr[1] = 100
print(s3)
```

#### 1.2 用字典创建 Series

```python
d = {'name': '张三', 'age': 18, 'sex': '男'}
s_dict = pd.Series(d)
print(s_dict)
# 输出：
# name    张三
# age       18
# sex       男
# dtype: object
```

------

### 2. DataFrame

```python
# 用字典创建 DataFrame（每个键对应一列）
df = pd.DataFrame({
    'name': ['Alice', 'Bob', 'Charlie'],
    'age': [25, 30, 35],
    'score': [88.5, 92.0, 85.0]
})
print(df)
# 输出：
#       name  age  score
# 0    Alice   25   88.5
# 1      Bob   30   92.0
# 2  Charlie   35   85.0

# 查看属性
print(df.shape)       # 输出：(3, 3)
print(df.columns)     # 输出：Index(['name', 'age', 'score'], dtype='object')
print(df.index)       # 输出：RangeIndex(start=0, stop=3, step=1)
print(df.dtypes)      # 输出每列的数据类型

# 访问列与行
print(df['name'])        # 这会返回一个 Series
print(df.loc[1])         # 第 1 行数据（标签位置）
print(df.iloc[0:2, 0:2])  # 用位置切片：前两行，前两列
```

------

### 3. 基本操作：增、删、改、查

```python
# 新增列
df['newcol'] = df['age'] * 2
print(df)

# 删除列
df2 = df.drop(columns=['newcol'])
print(df2)

# 修改值
df.at[1, 'age'] = 31
print(df.loc[1])

# 条件过滤 / 布尔索引
df_filtered = df[df['score'] > 90]
print(df_filtered)
```

------

### 4. 缺失值 & 重复值处理

```python
# 构造带 NaN 的 DataFrame
df_missing = pd.DataFrame({
    'A': [1, np.nan, 3],
    'B': [4, 5, np.nan]
})
print(df_missing)

# 检查缺失值
print(df_missing.isnull())
print(df_missing.isnull().sum())

# 填充缺失值
df_fill0 = df_missing.fillna(0)
print(df_fill0)

# 删除含缺失值的行/列
df_drop = df_missing.dropna(axis=0)  # 删除行
print(df_drop)
```

------

### 5. 分组与聚合（GroupBy）

```python
# 示例 DataFrame
df3 = pd.DataFrame({
    'key': ['A', 'B', 'A', 'B'],
    'value': [10, 20, 15, 25]
})

grouped = df3.groupby('key')
print(grouped.sum())
# 输出：
#      value
# key       
# A        25
# B        45

print(grouped['value'].mean())
# 输出平均值
```

------

### 6. 合并 / 连接 / 拼接

```python
df1 = pd.DataFrame({'id': [1,2,3], 'x': ['a','b','c']})
df2 = pd.DataFrame({'id': [2,3,4], 'y': [20, 30, 40]})

# 内连接（类似 SQL 的 inner join）
df_join = pd.merge(df1, df2, on='id', how='inner')
print(df_join)

# 外连接
df_outer = pd.merge(df1, df2, on='id', how='outer')
print(df_outer)

# 拼接（上下 / 左右方向）
df_vert = pd.concat([df1, df2], axis=0, ignore_index=True)
print(df_vert)

df_horiz = pd.concat([df1, df2], axis=1)
print(df_horiz)
```

------

### 7. 时间序列操作（简要）

```python
dates = pd.date_range('2025-01-01', periods=6, freq='D')
df_ts = pd.DataFrame({
    'date': dates,
    'value': [10, 12, 11, 15, 14, 13]
})
df_ts = df_ts.set_index('date')
print(df_ts)

# 重采样 / 滚动窗口
print(df_ts.resample('2D').mean())   # 每两天取平均
print(df_ts.rolling(window=3).mean())  # 滑动窗口均值
```

------

### 8. 读取 / 存储数据

```python
# 读取 CSV
df_csv = pd.read_csv('data.csv')
# 写入 CSV
df_csv.to_csv('out.csv', index=False)

# 读取 Excel
# df_excel = pd.read_excel('data.xlsx', sheet_name='Sheet1')
# 写入 Excel
# df_excel.to_excel('out.xlsx', index=False)

# 读取 / 写入 JSON
# df_json = pd.read_json('data.json')
# df_csv.to_json('out.json')
```