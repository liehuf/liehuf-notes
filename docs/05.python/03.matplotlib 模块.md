---
title: 03.matplotlib 模块
date: 2025-09-27 14:30:00
permalink: /pages/Python_03/
---

# Matplotlib 模块

## Matplotlib 简介

Matplotlib 是 Python 中最常用的可视化库之一，尤其是其中的 `pyplot` 模块，
提供了类似 Matlab 的绘图接口。它适合快速绘制折线图、散点图、柱状图、直方图、饼图等，
并且可以对图像进行灵活的修饰（标题、坐标轴、图例、网格、子图等）。

特点：

- 功能全面：支持常见 2D 图表和部分 3D 图表
- 使用灵活：可以快捷调用 `pyplot` 画图，也可以精细控制 `Figure` 和 `Axes`
- 与 NumPy / Pandas / SciPy 无缝结合
- 丰富的自定义：颜色、线型、标记、布局等均可调整

通常的下载方法：

```shell
pip install matplotlib
```

---

## 一、绘图基础

### 1.1 导入与接口风格

```python
import numpy as np
import matplotlib.pyplot as plt
```

Matplotlib 常见有两种接口风格：

- **Pyplot（状态机）接口**：`plt.plot(...)`，快捷，适合交互与一次性小图。类似 MATLAB 风格。
- **面向对象（OO）接口**：先创建 `Figure` / `Axes`，然后在 `Axes` 上调用方法（如 `ax.plot(...)`）。更灵活、适合复杂布局和脚本化绘图。

建议以 OO 接口为主，必要时在交互中使用 `plt` 快捷方法。

### 1.2 Figure / Axes / Axis 概念

- `Figure`：整个图像（画布）。
- `Axes`：绘图区域（包含坐标轴、刻度、标题、图例等）。一个 `Figure` 可包含多个 `Axes`。
- `Axis`：坐标轴（x、y、z），负责刻度和刻度标签。

创建方式：

```python
fig, ax = plt.subplots(figsize=(8,5), dpi=100)
# 多子图
fig, axes = plt.subplots(2, 2, figsize=(10,8))
```

`figsize` 单位为英寸 (inch)，图像像素大小 = `figsize * dpi`。`tight_layout()` 或 `constrained_layout=True` 用于自动调整子图间距。

### 1.3 显示与保存

```python
plt.show()  # 在交互式环境显示
fig.savefig('out.png', dpi=300, bbox_inches='tight', transparent=False)
```

常用 `savefig` 参数：
- `dpi`：分辨率
- `bbox_inches='tight'`：紧凑边界，避免标签被截断
- `transparent=True`：透明背景（适合嵌入网页）

---

## 二、常见图表（函数归纳 + 示例）

> 每个小节都给出常用参数与最小示例。

### 2.1 折线图（Line Plot）

**函数**：`ax.plot(x, y, **kwargs)`

**常用参数**：`color`/`c`、`linestyle`/`ls`、`linewidth`/`lw`、`marker`、`markersize`/`ms`、`label`

```python
x = np.linspace(0, 2*np.pi, 200)
y = np.sin(x)
fig, ax = plt.subplots()
ax.plot(x, y, label=r'$y=\sin x$', lw=2, ls='-', marker=None)
ax.set_xlabel('x')
ax.set_ylabel('y')
ax.legend()
```

备注：可绘多条线，常与 `ax.fill_between`（区域填充）配合。

### 2.2 散点图（Scatter）

**函数**：`ax.scatter(x, y, c=None, s=None, marker=None, cmap=None, alpha=None)`

- `c`：颜色或数值数组（配合 `cmap`）
- `s`：点大小（或数组）
- `alpha`：透明度

```python
x = np.random.rand(100)
y = np.random.rand(100)
s = 50 * np.random.rand(100)
fig, ax = plt.subplots()
ax.scatter(x, y, c=y, s=s, cmap='viridis', alpha=0.8)
ax.set_title('Scatter example')
```

### 2.3 柱状图（Bar）

**函数**：`ax.bar(x, height, width=0.8, bottom=None, align='center', **kwargs)` 或 `ax.barh`（水平柱状）

- 分组条形图：移动 x 的偏移量；堆叠条形图：使用 `bottom` 指定下边界

```python
labels = ['A','B','C']
val1 = [10, 15, 7]
val2 = [5, 8, 3]
ind = np.arange(len(labels))
width = 0.35
fig, ax = plt.subplots()
ax.bar(ind - width/2, val1, width, label='G1')
ax.bar(ind + width/2, val2, width, label='G2')
ax.set_xticks(ind)
ax.set_xticklabels(labels)
ax.legend()
```

**堆叠示例**：`ax.bar(x, val1); ax.bar(x, val2, bottom=val1)`

### 2.4 直方图（Histogram）

**函数**：`ax.hist(data, bins=10, range=None, density=False, histtype='bar', alpha=0.7)`

- `density=True` 将 y 转为概率密度
- `bins` 可为整数或序列（自定义切分区间）

```python
data = np.random.normal(loc=0, scale=1, size=1000)
fig, ax = plt.subplots()
ax.hist(data, bins=30, density=True, alpha=0.6)
```

### 2.5 饼图（Pie）

**函数**：`ax.pie(sizes, labels=None, autopct=None, startangle=0, explode=None)`

- `autopct='%.1f%%'` 自动显示百分比

```python
sizes = [30, 45, 25]
labels = ['A','B','C']
fig, ax = plt.subplots()
ax.pie(sizes, labels=labels, autopct='%.1f%%', startangle=90)
ax.axis('equal')  # 使饼图为圆形
```

### 2.6 箱型图（Boxplot）

**函数**：`ax.boxplot(data, notch=False, patch_artist=False)`

- 展示中位数、四分位、异常值

```python
data = [np.random.normal(i, 1, 200) for i in range(3)]
fig, ax = plt.subplots()
ax.boxplot(data, labels=['G1','G2','G3'])
```

### 2.7 小提琴图（Violinplot）

**函数**：`ax.violinplot(dataset, showmeans=False, showmedians=True)`

- 能显示数据分布的核密度估计，比箱型图更直观地展现分布形态

```python
fig, ax = plt.subplots()
ax.violinplot(data)
ax.set_xticks([1,2,3])
ax.set_xticklabels(['G1','G2','G3'])
```

---

## 三、进阶绘图

### 3.1 双轴（twinx / twiny）

> 用于 x 轴共享但 y 轴单位不同的情况。

```python
fig, ax1 = plt.subplots()
ax2 = ax1.twinx()
ax1.plot(x, y1, 'g-', label='y1')
ax2.plot(x, y2, 'b--', label='y2')
```

要注意图例可分别处理或手动合并图例条目。

### 3.2 多子图与布局控制

- `plt.subplots(nrows, ncols, figsize=...)`
- `GridSpec` / `plt.subplot2grid`：更灵活的网格控制
- `constrained_layout=True` 或 `fig.tight_layout()`：自动收紧布局

```python
from matplotlib.gridspec import GridSpec
fig = plt.figure(figsize=(8,6))
gs = GridSpec(3, 3, figure=fig)
ax_main = fig.add_subplot(gs[0:2, :])
ax_bottom = fig.add_subplot(gs[2, :])
```

### 3.3 等高线（Contour）与热力图（Heatmap）

```python
X = np.linspace(-3, 3, 200)
Y = np.linspace(-3, 3, 200)
X, Y = np.meshgrid(X, Y)
Z = np.sin(np.sqrt(X**2 + Y**2))
fig, ax = plt.subplots()
cf = ax.contourf(X, Y, Z, levels=40, cmap='viridis')
fig.colorbar(cf, ax=ax)
```

热力图（`imshow`）适合规则网格数据或图像显示：`ax.imshow(array, origin='lower', cmap='hot')`

### 3.4 向量场（Quiver）

```python
x = np.linspace(0, 2*np.pi, 20)
y = np.linspace(0, 2*np.pi, 20)
X, Y = np.meshgrid(x, y)
U = np.cos(X)
V = np.sin(Y)
fig, ax = plt.subplots()
ax.quiver(X, Y, U, V)
```

### 3.5 3D 绘图（简要）

启用 3D 投影：`ax = fig.add_subplot(111, projection='3d')`，然后使用 `plot3D`、`scatter3D`、`plot_surface` 等。

```python
from mpl_toolkits.mplot3d import Axes3D
fig = plt.figure()
ax = fig.add_subplot(111, projection='3d')
ax.plot3D(x, y, z)
```

---

## 四、美化与增强（提高可读性与出版级图表）

### 4.1 坐标轴与刻度控制

```python
ax.set_xlim(0, 10)
ax.set_ylim(-1.5, 1.5)
ax.set_xticks([0, 2, 4, 6, 8, 10])
ax.set_xticklabels(['0','2','4','6','8','10'], rotation=45)
```

进阶：使用 `matplotlib.ticker` 中的 `MaxNLocator`, `AutoMinorLocator`, `FuncFormatter` 来精细控制刻度。

### 4.2 边框（Spines）与坐标比例

```python
ax.spines['top'].set_visible(False)
ax.spines['right'].set_visible(False)
ax.set_aspect('equal')
```

### 4.3 图例（Legend）

```python
ax.legend(loc='best', fontsize=10, frameon=False)
# 合并多个 axes 的 legend 示例
lines, labels = ax1.get_legend_handles_labels()
lines2, labels2 = ax2.get_legend_handles_labels()
ax1.legend(lines + lines2, labels + labels2, loc='best')
```

### 4.4 文本与注释（text / annotate）

```python
ax.text(0.1, 0.9, '注释示例', transform=ax.transAxes)
ax.annotate('峰值', xy=(x0,y0), xytext=(x0+0.5,y0+0.5),
            arrowprops=dict(arrowstyle='->', lw=1.5))
```

注意 `transform`：可使用 `ax.transAxes`（以轴为坐标，0-1）或 `ax.transData`（数据坐标）。

### 4.5 数学公式（MathText）

使用 `$...$` 包裹 LaTeX 风格表达式：

```python
ax.set_title(r'$E=mc^2$')
ax.set_ylabel(r'$\alpha + \beta x$')
```

### 4.6 颜色与色图（colormap）

- 常用 colormap：`viridis`, `plasma`, `inferno`, `magma`, `cividis`, `coolwarm` 等。
- `plt.cm.get_cmap('viridis')` 获取 colormap 对象。

```python
sc = ax.scatter(x, y, c=vals, cmap='plasma')
fig.colorbar(sc, ax=ax)
```

### 4.7 图像读写（imread / imsave / imshow）

```python
import matplotlib.image as mpimg
img = mpimg.imread('image.png')
ax.imshow(img, origin='lower')
plt.imsave('out.png', img)
```

### 4.8 坐标转换（Transforms）

常用变换对象：
- `ax.transData`（数据坐标）
- `ax.transAxes`（轴坐标，范围 0-1）
- `fig.transFigure`（图形坐标）

使用例子：在轴内比例位置添加文本 `ax.text(0.5, 0.1, 'foo', transform=ax.transAxes)`。

