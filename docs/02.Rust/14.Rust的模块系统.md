---
title: 14.Rust的模块系统
date: 2025-08-27 22:00:00
permalink: /pages/Rust_14/
---

# Rust 的模块系统

在 Rust 里，项目不可能一直放在一个文件里，越写越多肯定会乱套。
 所以语言本身提供了一整套“组织工具”来帮你：

- **包（Package）和 Crate**：整体的管理和构建单位
- **模块（Module）**：代码的逻辑分块
- **路径（Path）**：告诉编译器去哪儿找你写的东西
- **use**：给路径起别名、简化访问
- **分文件管理**：让文件夹结构和模块结构对齐

下面我们逐一来看。

------

## 一、包（Package）和 Crate

- **Crate** 就是 Rust 的最小编译单元。
  - 如果有 `main` 函数，它就是 **二进制 Crate**，能直接运行。
  - 如果没有 `main`，只是提供功能，那就是 **库 Crate**，只能被别人引用。
- **Package** 是一个或多个 Crate 的集合，它里面有 `Cargo.toml` 文件来说明怎么构建。
  - 一个包最多只能有 **一个库 Crate**。
  - 但可以有多个二进制 Crate（放在 `src/bin/` 目录里）。

👉 举个栗子：

```css
my_project/
 ├─ Cargo.toml   # 包的配置
 └─ src/
     └─ main.rs  # 默认的二进制 crate
```

------

## 二、模块（mod）和可见性

随着项目增长，我们会用 **模块**（module）把代码分块。
 写法是这样的：

```rust
mod network {
    fn connect() {
        println!("connected!");
    }
}
```

这里的 `network` 就是一个模块。
 要注意，**模块里的东西默认是私有的**，外面用不了。

想让外面能用，就要加 `pub`：

```rust
mod network {
    pub fn connect() {
        println!("connected!");
    }
}

fn main() {
    network::connect();
}
```

------

## 三、路径（Path）

如果模块越来越多，就要学会用路径来访问。路径分两种：

- **绝对路径**：从 crate 根开始，比如 `crate::network::connect`
- **相对路径**：从当前位置开始，比如 `super::` 往上，`self::` 当前模块

```rust
mod network {
    pub fn connect() {}
}

fn main() {
    // 绝对路径
    crate::network::connect();

    // 相对路径（在 main.rs 顶层）
    network::connect();
}
```

------

## 四、use 简化路径

如果你老是写 `crate::network::connect`，会很烦。
 这时可以用 `use`：

```rust
mod network {
    pub fn connect() {}
}

use crate::network::connect;

fn main() {
    connect();
}
```

还可以给名字起别名：

```rust
use crate::network::connect as net_connect;

fn main() {
    net_connect();
}
```

要让别人也能用这个简化路径，可以写 `pub use`。这叫“重导出”。

------

## 五、模块拆分到文件

当模块越来越大，可以把它们分到不同的文件。

假设你写了 `mod network;`，Rust 会去找：

1. `network.rs` 文件
2. 或者 `network/mod.rs` 文件

比如目录长这样：

```css
src/
 ├─ main.rs
 └─ network.rs
```

`main.rs` 里写：

```rust
mod network;

fn main() {
    network::connect();
}
```

`network.rs` 文件里写：

```rust
pub fn connect() {
    println!("connected!");
}
```

这样，模块和文件夹结构就能对上了，阅读起来很清晰。
