---
title: 02.指针的高阶用法
date: 2025-10-09 0:00:00
permalink: /pages/C_02/
---

## 1.字符指针

字符指针通常用 `char*` 声明，一般可以指向字符变量和字符常量

```C
int main()
{
	char ch = "ikun";
	char *pc = &ch;         // pc 指向一个字符变量
	
	const char *p = "ikun"; // 将 "ikun" 首字母 'i' 赋给 p 
}
```

## 2.指针数组

指针数组是一个数组，它用来存储指针，以指针为元素

一般声明为： `int *p[n]` 或`char *p[n]`

初始化过程通常为：
```C
//整形指针数据
int a = 10;
int b = 20;
int c = 30;
int d = 40;
int *arr[4] = {&a, &b, &c, &d};

//字符指针数组
char *arr[3] = {"ikun", "xiaoheizi", "zhenaifen"}
```

## 3.数组指针

数组指针是一个指针，其指向数组

一般可声明: `int (*p)[n]`

定义一个数组，`int a[] = {1, 2, 3, 4}`
其中`a`是数组首元素的首地址，也就是a[0]的首地址
而`&a`是数组的首地址；
更进一步，`a+1`是数组下一元素的首地址，即a[1]的首地址
`&a+1` 是下一个数组的首地址 

下面的程序演示了如何打印数组指针指向的数据：
```c
void print(int (*parr)[10], int sz)//传上来地址，用数组指针接受
{
	int i = 0;
	for (i = 0; i < sz; i++)
	{
	//以下3种方式都能打印
	//printf("%d ", parr[0][i]);//把一维数组当成二维数组，[0]表 示第一行，[i]表示遍历元素
		//printf("%d ", (*(parr + 0))[i]);//*(parr + 0)解引用首元素地址
		printf("%d ", (*parr)[i]);//(*parr) 相当于 parr指向的数组的数组名
	}
}
int main()
{
	int arr[10] = {1,2,3,4,5,6,7,8,9,10};
	int sz = sizeof(arr) / sizeof(arr[0]);
	print(&arr, sz);//&arr把数组的首元素地址传上去函数

	return 0;
}
```

## 4.数组参数和指针参数

`参数`分为形参和实参
+ 形参是生命或定义函数时的参数
+ 实参是在调用函数时主调函数传递的实际值

传参本质上就是传入地址，函数内部再处理

## 5.函数指针

函数指针指向一个函数，其本质上还是指针

```c
#include <stdio.h>
#include <string.h>

char * fun(char * p1, char * p2)
{
	int i = 0;
	i = strcmp(p1, p2);
	if (0 == i)
	{
		return p1;
	}
	else
	{
		return p2;
	}
}
int main()
{
	char * (*pf)(char * p1, char * p2);
	pf = &fun;
	(*pf) ("ikun", "xiaoheizi");
	return 0;
}
```

## 6.回调函数

根据比较官方的解释：

把一段可执行的代码像参数传递那样传给其他代码，而这段代码会在某个时刻被调用执行，这就叫做回调。如果代码立即被执行就称为同步回调，如果在之后晚点的某个时间再执行，则称之为异步回调

人话：
函数 F1 调用函数 F2 的时候，函数 F1 通过参数给函数 F2 传递了另外一个函数 F3 的指针，在函数 F2 执行的过程中，函数F2 调用了函数 F3，这个动作就叫做回调（Callback），而先被当做指针传入、后面又被回调的函数 F3 就是回调函数

代码解释：
```c
int Add(int x, int y)
{
	return x + y;
}

int Sub(int x, int y)
{
	return x - y;
}

void Cale(int(*pf)(int, int))//通过指针传地址
{
	int ret = pf(3, 5);
	printf("%d\n", ret);
}

int main()
{
	//Cale(Add);
	Cale(Sub);//调用函数
	return 0;
}
```