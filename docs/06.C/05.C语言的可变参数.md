---
title: 05.C 语言的可变参数
date: 2025-10-15 23:00:00
permalink: /pages/C_05/
---

# C 语言的可变参数

有时我们并不确定将要输入的参数有几个，比如 头文件<stdio.h>中的`printf`函数，因此，我们就需要使用一个名为**可变参数**的高级方法

使用可变参数，我们要引用头文件 <stdarg.h>,该文件提供了实现可变参数功能的函数和宏,具体的实现步骤如下：

- 定义一个函数，最后一个参数为省略号，省略号前面可以设置自定义参数。
- 在函数定义中创建一个 **va_list** 类型变量，该类型是在 stdarg.h 头文件中定义的。
- 使用 **int** 参数和 **va_start()** 宏来初始化 **va_list** 变量为一个参数列表。宏 **va_start()** 是在 stdarg.h 头文件中定义的。
- 使用 **va_arg()** 宏和 **va_list** 变量来访问参数列表中的每个项。
- 使用宏 **va_end()** 来清理赋予 **va_list** 变量的内存。

常用的宏有：

- `**va_start(ap, last_arg)**`：初始化可变参数列表。`ap` 是一个 `va_list` 类型的变量，`last_arg` 是最后一个固定参数的名称（也就是可变参数列表之前的参数）。该宏将 `ap` 指向可变参数列表中的第一个参数。
- `**va_arg(ap, type)**`：获取可变参数列表中的下一个参数。`ap` 是一个 `va_list` 类型的变量，`type` 是下一个参数的类型。该宏返回类型为 `type` 的值，并将 `ap` 指向下一个参数。
- `**va_end(ap)**`：结束可变参数列表的访问。`ap` 是一个 `va_list` 类型的变量。该宏将 `ap` 置为 `NULL`。

下面的程序演示了一个实现计算平均值的方法：

```c
#include <stdio.h>
#include <stdarg.h>  // 使用可变参数要包含这个头文件

// 定义一个函数，求n个数的平均值
double average(int count, ...) {
    va_list args;     // 定义一个可变参数列表变量
    double sum = 0.0;

    va_start(args, count);  // 初始化，可变参数从count后面开始取

    for (int i = 0; i < count; i++) 
    {
        double num = va_arg(args, double);  // 依次取出每个参数（注意类型要匹配）
        sum += num;
    }

    va_end(args);  // 结束可变参数的访问

    return sum / count;
}

int main(void) {
    double avg1 = average(3, 10.0, 20.0, 30.0);
    double avg2 = average(5, 1.0, 2.0, 3.0, 4.0, 5.0);

    printf("avg1 = %.2f\n", avg1);
    printf("avg2 = %.2f\n", avg2);

    return 0;
}

```

