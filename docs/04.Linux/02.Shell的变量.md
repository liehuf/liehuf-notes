---
title: 02.Shell的变量
date: 2025-09-20 22:00:00
permalink: /pages/Linux_02/
---

# Shell脚本的变量

### 变量的定义

**变量**就是“在脚本运行周期内值可以变化的名字”，用来保存字符串或数字，脚本里通过名字去引用它的值。

### 命名规则（必须牢牢记住）

- 只能用：英文字母（A–Z、a–z）、数字（0–9）、下划线（`_`）。
- **首字符不能是数字**（比如 `2name=...` 会报错）。
- **等号两边不能有空格**（`name = 1` 会报错，正确写 `name=1`）。
- 如果值里有空格，要用引号包起来：`msg="hello world"`。
- 变量名建议用大写来表示环境变量（约定俗成），小写通常是脚本内部变量。

**示例**

```shell
name="ikun"       # 正确
2name="xiaoheizi"        #  错误：不能以数字开头
name = "kun"        #  错误：等号两边不能有空格
```

### 引号：单引号 vs 双引号

- **单引号 `'...'`**：原样输出，不做变量替换或命令替换。

  ```shell
  name=ikun
  echo '$name'   # 输出 $name
  ```

- **双引号 `"..."`**：会进行变量替换和命令替换（但保留空格），且支持转义 `\`。

  ```shell
  echo "$name"   # 输出 ikun
  ```

- 推荐：当字符串里有变量或命令替换时用双引号；要输出**字面量**时用单引号。

### 常用“特殊符号”与它们的作用

- ``command`` 或 `$(command)`：**命令替换**，会先执行括号/反引号内的命令，再把结果作为文本返回。推荐用 `$(...)`。

  ```shell
  now=$(date)
  echo $now
  ```

- `{}`：变量扩展 / 分组。例如 `${var}` 可避免歧义，或者用于子串替换/截取。

  ```shell
  echo ${name}哥
  ```

- `()`：在 **子 Shell** 中执行命令（子 Shell 的变量改动不会影响父 Shell）。

- `[]`：常用于 `test` 或 `[ ... ]` 条件判断。

- `\`：转义字符，把后面的字符当作普通字符处理。

- `#`：注释行的开头（`#` 后面的内容不执行）。

### 变量定义与调用

- **定义（赋值）**（注意：无空格）：

  ```shell
  foo=123
  msg="hello world"
  ```

- **调用**：

  ```shell
  echo $foo
  echo ${msg}
  ```

- **推荐写法**：使用 `${var}` 在字符串拼接时不容易产生歧义：

  ```shell
  path="/home/$USER"
  echo "${path}/file.txt"
  ```

### 追加/拼接变量值

```shell
s="123"
s="${s}456"    # 结果: 123456
# 或者 s="$s"456  但最好用 ${s} 方式更安全
```

### 删除变量

- 用 `unset`：

  ```shell
  unset foo
  echo $foo   # 无输出
  ```

- `unset` 既可以删除普通变量，也可以删除环境变量（不过若变量通过 `readonly` 定义或导出到某种保护环境，有例外）。

### 环境变量（export）

- **普通变量**只在当前 shell/脚本有效；**环境变量**使用 `export` 导出后会传给子进程（如脚本或命令）。

  ```shell
  AGE=18
  export AGE       # 现在 AGE 是环境变量
  ```

- 删除环境变量：`unset VAR`。

- 查看：

  - `env`：只显示**环境变量**。
  - `set`：显示 **所有变量（包括 shell 函数、普通变量、环境变量）**

**注意**：把变量写入 `~/.bashrc`、`~/.profile` 或 `/etc/profile` 才能在新的登录/会话中持久化（博文提到系统默认环境变量通常在 `/etc/profile` 等处定义）。

### 位置参数（脚本传参）——实用且常用

当脚本以参数形式运行时，可以在脚本里通过 `$1`、`$2`... 访问：

- `$0`：脚本名（或执行命令名）。
- `$1` 到 `$9`：第 1 到第 9 个参数（超过 9 个要用大括号，例如 `${10}`）。
- `$*`：把命令行所有参数当作 **一个整体**（整体展开为单个字符串）。
- `$@`：把所有参数 **分别对待**（在 `for` 循环中通常比 `$*` 更合用）。
- `$#`：参数个数。

**示例脚本**

```shell
#!/bin/bash
echo "脚本名: $0"
echo "第1个参数: $1"
echo "参数个数: $#"

# $@ vs $* 示例
for v in "$@"; do
  echo "param: $v"
done
```

说明：`$*` 会把所有参数看成一个整体 → `for` 循环只会执行一次；`$@` 会把每个参数单独分开 → `for` 会按参数个数循环多次。博文提供了示例。

### 预定义变量（内建特殊变量）——最常用的几个

- `$?`：**上一条命令的返回值**（0 表示成功；非 0 表示失败，具体值视命令而定）。

  ```shell
  ls /not_exist
  echo $?   # 非0，说明失败
  ```

- `$$`：当前脚本/进程的 PID。

  ```shell
  echo $$   # 比如输出 12345
  ```

- `$!`：最近一个**后台运行**命令的 PID（当你在命令后面加 `&` 时）。

  ```shell
  sleep 30 &
  echo $!   # sleep 命令的 PID
  ```

###  只读变量

- 用 `readonly 变量名` 将变量设为只读，之后修改会报错（适合常量）。

  ```shell
  a=10
  readonly a
  a=20   # 会报错: readonly variable
  echo $a  # 还是 10
  ```

### 从键盘接受输入并存变量（`read`）

`read` 可以把用户输入保存到变量：

```shell
read -p "请输入名字: " name
echo "你好, $name"
```

常用选项：

- `-p`：显示提示信息
- `-t`：超时时间（秒）
- `-n N`：只读 N 个字符
- `-s`：隐藏输入（用于密码）
   如果不指定变量名，输入会保存在默认变量 `REPLY` 中。[CSDN Blog](https://blog.csdn.net/w918589859/article/details/108752592)

### 常见坑 & 好习惯（实战中会卡的点）

1. **等号两边不能有空格**（最常见的错误）。
2. **字符串拼接时最好用 `${var}`**，避免 `"${a}b"` 被误读为 `$ab`。
3. **用双引号包变量**：`"$var"` 比 `$var` 更安全（防止单词拆分和通配符扩展）。
   - 错误示例：`for f in $files; do` 会把带空格的文件名拆开；改成 `for f in "$files"; do` 或更好用数组。
4. **记得 `export` 才会把变量传给子进程**。
5. **`$@` 在循环时用双引号**：`for x in "$@"; do ...`（处理带空格的参数正确）。
6. **用 `set` 与 `env` 分别查看变量**：`set` 显示所有，`env` 显示环境变量。[CSDN Blog+1](https://blog.csdn.net/w918589859/article/details/108752592)

### 快速实操练习（做三个小脚本：5 分钟上手）

把下面三个小脚本贴到你的板子或终端试试，能快速巩固概念。

A) 传参脚本 `args.sh`：

```shell
#!/bin/bash
echo "脚本名: $0"
echo "参数个数: $#"
echo "所有参数（分别）:"
for p in "$@"; do
  echo "  -> $p"
done
```

B) 环境变量示例 `env_example.sh`：

```shell
#!/bin/bash
MYVAR="hello"
export MYVAR
bash -c 'echo child sees MYVAR=$MYVAR'   # 子shell 能看到 MYVAR
```

C) 读输入并只读变量 `read_and_readonly.sh`：

```shell
#!/bin/bash
read -p "输入常量名: " n
readonly $n
echo "已设 $n 为只读（试着重新赋值看会报错）"
```

### 速查备忘（Cheat-sheet）

- 定义：`var=value`
- 调用：`$var` 或 `${var}`
- 导出（环境变量）：`export VAR=value`
- 删除：`unset VAR`
- 只读：`readonly VAR`
- 参数：`$0` `$1` ... `$#` `$@` `$*`
- 状态码：`$?`，当前PID：`$$`，后台最后进程：`$!`
- 命令替换：`$(command)`（推荐）或 ``command``
