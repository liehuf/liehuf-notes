(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{407:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"读二进制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#读二进制"}},[s._v("#")]),s._v(" 读二进制")]),s._v(" "),a("h2",{attrs:{id:"一、readelf-读elf文件的骨架"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、readelf-读elf文件的骨架"}},[s._v("#")]),s._v(' 一、readelf-"读ELF文件的骨架"')]),s._v(" "),a("h3",{attrs:{id:"readelf-三个核心选项-h、-s、-s"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#readelf-三个核心选项-h、-s、-s"}},[s._v("#")]),s._v(" readelf 三个核心选项（-h、-S、-s）")]),s._v(" "),a("p",[a("code",[s._v("-h")]),s._v("（--file-header）")]),s._v(" "),a("p",[s._v("显示 "),a("strong",[s._v("ELF 文件头")]),s._v("（最顶层元信息）")]),s._v(" "),a("ul",[a("li",[s._v("看文件类型（EXEC/DYN/REL）、位数（32/64）、架构、入口地址、程序 / 节头偏移等")])]),s._v(" "),a("p",[s._v("S`（--sections）")]),s._v(" "),a("p",[s._v("显示 "),a("strong",[s._v("节头表（Section Headers）")])]),s._v(" "),a("ul",[a("li",[s._v("看所有节（.text/.data/.rodata/.symtab 等）的名称、类型、地址、大小、偏移")])]),s._v(" "),a("p",[a("code",[s._v("-s")]),s._v("（--symbols）")]),s._v(" "),a("p",[s._v("显示 "),a("strong",[s._v("符号表（Symbol Table）")])]),s._v(" "),a("ul",[a("li",[s._v("看所有符号（函数、变量、外部引用）的类型、值、大小、绑定、所在节")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ikun@ubuntu2004:~/Desktop/link_test$ readelf "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" test_dynamic\nELF 头：\n  Magic：   7f "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" 4c "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("46")]),s._v(" 02 01 01 00 00 00 00 00 00 00 00 00 \n  类别:                              ELF64\n  数据:                              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" 补码，小端序 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("little endian"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  OS/ABI:                            UNIX - System V\n  类型:                              DYN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Position-Independent Executable "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  系统架构:                          Advanced Micro Devices X86-64\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("有魔数、类别为ELF64、类型为 DYN（动态链接可执行文件）")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ikun@ubuntu2004:~/Desktop/link_test$ readelf "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-S")]),s._v(" test_dynamic "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-E")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text|data|bss"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .text             PROGBITS         00000000000010a0  000010a0\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .rodata           PROGBITS         0000000000002000  00002000\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .data             PROGBITS         0000000000004000  00003000\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" .bss              NOBITS           0000000000004010  00003010\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("这是在看 "),a("strong",[s._v("Section（段）")]),s._v("，不是运行时视角，而是"),a("strong",[s._v("链接/存储视角")]),s._v("。")]),s._v(" "),a("ul",[a("li",[s._v(".text ："),a("strong",[s._v("只读 + 可执行")]),s._v("，放的是机器码")]),s._v(" "),a("li",[s._v(".data："),a("strong",[s._v("可读写")]),s._v("放“已初始化的全局变量”")]),s._v(" "),a("li",[s._v(".bss："),a("strong",[s._v("可读写")]),s._v("放“未初始化的全局变量”磁盘上不占空间")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ikun@ubuntu2004:~/Desktop/link_test$ readelf "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" test_dynamic "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-E")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"add|mul|printf"')]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(": 0000000000000000     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" FUNC    GLOBAL DEFAULT  UND "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(": 0000000000000000     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" FUNC    GLOBAL DEFAULT  UND mul\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(": 0000000000000000     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" FUNC    GLOBAL DEFAULT  UND "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(": 0000000000000000     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" FUNC    GLOBAL DEFAULT  UND printf@GLIBC_2.2.5\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v(": 0000000000000000     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" FUNC    GLOBAL DEFAULT  UND mul\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("这就是动态链接本质：不是“没有这个函数”，而是： “这个 ELF 自己不负责实现它。”")]),s._v(" "),a("h2",{attrs:{id:"二、objdump-你在-看-cpu-实际要跑的指令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、objdump-你在-看-cpu-实际要跑的指令"}},[s._v("#")]),s._v(" 二、objdump：你在“看 CPU 实际要跑的指令”")]),s._v(" "),a("p",[s._v("命令"),a("code",[s._v('objdump -d test_dynamic | grep -A 20 "<main>"')])]),s._v(" "),a("p",[s._v("其中 "),a("code",[s._v("objdump -d test_dynamic")]),s._v("这个二进制文件做反汇编，输出所有可执行代码段（.text）的汇编指令")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ikun@ubuntu2004:~/Desktop/link_test$ objdump "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" test_dynamic "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-A")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"<main>"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"plt"')]),s._v("\n    11ad:\te8 be fe ff ff       \tcall   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1070")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("add@plt"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("main 并没有直接 call add")]),s._v(" 它 call 的是 "),a("strong",[s._v("PLT 里的一个跳板")])]),s._v(" "),a("p",[s._v("PLT 是什么，不用背定义，只记行为：第一次调用：跳进动态链接器，查库、填地址，之后调用：直接跳到真实 "),a("code",[s._v("add")])]),s._v(" "),a("h2",{attrs:{id:"三、nm-链接方式探测器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、nm-链接方式探测器"}},[s._v("#")]),s._v(" 三、nm：链接方式探测器")]),s._v(" "),a("p",[a("strong",[s._v("nm = 查看二进制文件里的「符号表」")])]),s._v(" "),a("p",[s._v("也就是"),a("strong",[s._v("列出这个文件里有哪些函数、哪些全局变量、它们在哪、是什么类型。")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ikun@ubuntu2004:~/Desktop/link_test$ nm test_static "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"add$"')]),s._v("\n00000000004017b0 T "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v("\n0000000000488020 T __nptl_stack_list_add\nikun@ubuntu2004:~/Desktop/link_test$ nm test_dynamic "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"add$"')]),s._v("\n                 U "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("每一列含义：")]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("地址")])]),s._v(" "),a("li",[a("strong",[s._v("符号类型（大写字母）")])]),s._v(" "),a("li",[a("strong",[s._v("符号名（函数名 / 变量名）")])])]),s._v(" "),a("p",[s._v("符号类型：")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("T")]),s._v("：代码段里的函数（text 段）\n"),a("ul",[a("li",[s._v("比如 "),a("code",[s._v("main")]),s._v("、"),a("code",[s._v("foo")]),s._v("、"),a("code",[s._v("my_func")])])])]),s._v(" "),a("li",[a("strong",[s._v("U")]),s._v("：未定义符号（undefined）\n"),a("ul",[a("li",[s._v("意思是 "),a("strong",[s._v("我要用，但我没实现，要靠动态库给我")])]),s._v(" "),a("li",[s._v("比如 "),a("code",[s._v("printf")]),s._v("、"),a("code",[s._v("scanf")])])])]),s._v(" "),a("li",[a("strong",[s._v("D")]),s._v("：已初始化全局变量")]),s._v(" "),a("li",[a("strong",[s._v("B")]),s._v("：未初始化全局变量")])])])}),[],!1,null,null,null);a.default=e.exports}}]);