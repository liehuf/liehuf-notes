(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{370:function(t,s,a){"use strict";a.r(s);var n=a(16),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"修勾别复位-我来喂你"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修勾别复位-我来喂你"}},[t._v("#")]),t._v(" 修勾别复位，我来喂你")]),t._v(" "),s("h2",{attrs:{id:"_1-什么是看门狗-wdt"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是看门狗-wdt"}},[t._v("#")]),t._v(" 1. 什么是看门狗（WDT）？")]),t._v(" "),s("p",[t._v("“看门狗”WDT（Watchdog Timer）其实就是一个“定时复位装置”。如果你的程序一不小心跑飞了、死循环了、不响应了，看门狗就会跳出来重启系统，类似“自动拔电源再插一下”的狠角色。")]),t._v(" "),s("p",[t._v("🧠 类比理解：")]),t._v(" "),s("ul",[s("li",[t._v("正常工作时，"),s("strong",[t._v("你要定期喂它一口饭")]),t._v("（喂狗）")]),t._v(" "),s("li",[t._v("要是你忘了，它就“发疯咬你”，直接给你复位")])]),t._v(" "),s("blockquote",[s("p",[t._v("WDT = “你要活着，就别忘了让我知道你还活着”")])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"_2-wdt-的用途场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-wdt-的用途场景"}},[t._v("#")]),t._v(" 2. WDT 的用途场景")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("场景")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("程序卡死检测")]),t._v(" "),s("td",[t._v("代码死循环，无法退出，系统僵住")])]),t._v(" "),s("tr",[s("td",[t._v("内存溢出保护")]),t._v(" "),s("td",[t._v("异常分配造成堆栈错乱")])]),t._v(" "),s("tr",[s("td",[t._v("定时自检/重启")]),t._v(" "),s("td",[t._v("系统定期刷个存在感")])]),t._v(" "),s("tr",[s("td",[t._v("工业嵌入式应用")]),t._v(" "),s("td",[t._v("提高系统可靠性，关键设备必备")])])])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"_3-喂狗的基本素养"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-喂狗的基本素养"}},[t._v("#")]),t._v(" 3. 喂狗的基本素养")]),t._v(" "),s("div",{staticClass:"language-python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" machine "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" WDT\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" time\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 初始化看门狗：设定超时时间（单位：毫秒）")]),t._v("\nwdt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" WDT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("timeout"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"我还活着，别复位我！"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    wdt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("feed"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 喂狗，重置倒计时")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("h3",{attrs:{id:"⚙️-参数说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#⚙️-参数说明"}},[t._v("#")]),t._v(" ⚙️ 参数说明：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("参数名")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v("timeout")])]),t._v(" "),s("td",[t._v("看门狗超时时间（ms）")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v(".feed()")])]),t._v(" "),s("td",[t._v("喂狗，避免复位")])])])]),t._v(" "),s("h2",{attrs:{id:"_4-实验-假装程序死掉会发生什么"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-实验-假装程序死掉会发生什么"}},[t._v("#")]),t._v(" 4. 实验：假装程序死掉会发生什么？")]),t._v(" "),s("p",[t._v("你可以试试"),s("strong",[t._v("不喂狗")]),t._v("，看系统会不会乖乖复位：")]),t._v(" "),s("div",{staticClass:"language-python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" machine "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" WDT\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" time\n\nwdt "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" WDT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("timeout"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"我装死3秒，你咬我啊"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    time"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sleep"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 故意超过 3 秒不喂狗")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 没有 wdt.feed()，系统会被复位")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])]),s("p",[t._v("运行这个程序，3秒一过，K230会毫不犹豫地重启系统。日志会在串口里显示 "),s("code",[t._v("WDT Reset")]),t._v(" 字样。")]),t._v(" "),s("h2",{attrs:{id:"_5-复位之后能干点啥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-复位之后能干点啥"}},[t._v("#")]),t._v(" 5. 复位之后能干点啥？")]),t._v(" "),s("p",[t._v("你可以通过 "),s("code",[t._v("machine.reset_cause()")]),t._v(" 检查系统是被谁复位的，看看是不是狗咬的：")]),t._v(" "),s("div",{staticClass:"language-python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" machine\n\ncause "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" machine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("reset_cause"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" cause "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" machine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("WDT_RESET"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"🐶 看门狗复位了我"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"🔄 普通复位或其他原因"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("p",[t._v("这招适合在程序一启动就知道“我为什么会在这里”，有助于你搞清楚系统稳定性问题。")]),t._v(" "),s("h2",{attrs:{id:"_6-注意事项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-注意事项"}},[t._v("#")]),t._v(" 6. 注意事项")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("超时时间单位是毫秒")]),t._v("，别写成 3 以为是 3 秒，结果狗没来你先懵。")]),t._v(" "),s("li",[s("strong",[t._v("一旦初始化看门狗，就必须喂狗")]),t._v("，否则它肯定咬你。")]),t._v(" "),s("li",[t._v("有些平台支持禁用WDT，但在 K230 中你一旦启用就是实打实的“忠犬八公”。")]),t._v(" "),s("li",[t._v("如果你的任务循环时间比 WDT 超时时间长，你得手动 "),s("code",[t._v("feed()")]),t._v(" 前做分段设计。")])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"_7-进阶玩法建议-可拓展"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-进阶玩法建议-可拓展"}},[t._v("#")]),t._v(" 7. 进阶玩法建议（可拓展）")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("想法")]),t._v(" "),s("th",[t._v("说明")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("重启后记录信息")]),t._v(" "),s("td",[t._v("比如把“崩了”的位置写进 Flash/RTC RAM")])]),t._v(" "),s("tr",[s("td",[t._v("多线程喂狗")]),t._v(" "),s("td",[t._v("不同任务交替喂狗，检测线程挂死")])]),t._v(" "),s("tr",[s("td",[t._v("设置“看门狗门槛”")]),t._v(" "),s("td",[t._v("控制只有特定条件才启动 WDT")])])])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"_8-总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-总结"}},[t._v("#")]),t._v(" 8. 总结")]),t._v(" "),s("p",[t._v("🐶 看门狗的存在，是为了在你犯错时拉你一把（顺便咬你一口）。\n它不是万能的防挂机制，但在工业级系统里，它是可靠性的大哥大。\n写完代码别忘了加喂狗逻辑，就像每天给你的宠物倒碗饭，不然第二天你就得找补丁了。")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://wiki.lckfb.com/zh-hans/lushan-pi-k230/basic/wdt.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("K230 WDT 官方文档"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("MicroPython WDT API 文档")])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"免责声明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#免责声明"}},[t._v("#")]),t._v(" 免责声明")]),t._v(" "),s("p",[t._v("本文档及所有内容（包括文字、图片、代码等）均为作者基于嘉立创庐山派K230开发板公开资料和个人使用经验整理分享，仅供学习和技术交流之用。")]),t._v(" "),s("p",[t._v("所有涉及的品牌名称、商标、图片及相关资源均归嘉立创官方所有，未经授权不得用于商业宣传或其他用途。")]),t._v(" "),s("p",[t._v("作者与嘉立创官方无任何隶属或代理关系，内容不构成任何形式的官方承诺或保证。")]),t._v(" "),s("p",[t._v("用户在使用相关资源时，应遵守相应的开源协议和法律法规，确保合法合规。")]),t._v(" "),s("p",[t._v("如涉及版权问题，请联系作者或嘉立创官方处理。")])])}),[],!1,null,null,null);s.default=r.exports}}]);