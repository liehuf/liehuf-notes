(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{412:function(a,s,e){"use strict";e.r(s);var t=e(2),n=Object(t.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"从零实践-cmake-给有-gcc-makefile-基础的人"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#从零实践-cmake-给有-gcc-makefile-基础的人"}},[a._v("#")]),a._v(" 从零实践 CMake：给有 GCC / Makefile 基础的人")]),a._v(" "),s("h3",{attrs:{id:"一、为什么要学-cmake"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、为什么要学-cmake"}},[a._v("#")]),a._v(" 一、为什么要学 CMake")]),a._v(" "),s("p",[a._v("在真实工程（尤其是芯片 / 嵌入式 / 跨平台工程）中，手写 Makefile 会遇到：")]),a._v(" "),s("ul",[s("li",[a._v("规则重复")]),a._v(" "),s("li",[a._v("依赖难维护")]),a._v(" "),s("li",[a._v("多平台适配成本高")])]),a._v(" "),s("p",[a._v("CMake 的定位很明确：")]),a._v(" "),s("blockquote",[s("p",[s("strong",[a._v("用更高层的描述，生成底层构建系统（Make / Ninja）")])])]),a._v(" "),s("hr"),a._v(" "),s("h3",{attrs:{id:"二、解释一个最小版本的cmake"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、解释一个最小版本的cmake"}},[a._v("#")]),a._v(" 二、解释一个最小版本的CMake")]),a._v(" "),s("p",[a._v("逐行解释一个"),s("code",[a._v("CmakeLists.txt")]),a._v("：")]),a._v(" "),s("div",{staticClass:"language-cmake line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cmake"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("cmake_minimum_required")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token property"}},[a._v("VERSION")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3.16")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("project")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("cmake_demo C"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("add_executable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("app\n    main.c\n    calc.c\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("target_include_directories")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("app "),s("span",{pre:!0,attrs:{class:"token namespace"}},[a._v("PRIVATE")]),a._v(" ."),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br")])]),s("ul",[s("li",[s("p",[s("code",[a._v("cmake_minimum_required(VERSION 3.16)")]),a._v("：先跟当前的版本的CMake打个招呼，你是不是大于或等于"),s("code",[a._v("3.16")]),a._v("版本，是的话就继续，不是的话就报个错，别装懂")])]),a._v(" "),s("li",[s("p",[s("code",[a._v("project(cmake_demo C)")]),a._v("：这句可厉害了，他是CMake的开关，"),s("code",[a._v("cmake_demo")]),a._v("是项目名，"),s("code",[a._v("C")]),a._v("是语言，之后，CMake会去找"),s("code",[a._v("gcc")]),a._v("并确认是C语言的编译器，之后设置一大堆"),s("strong",[a._v("隐式变量")]),a._v("，再后面就是触发编译器能力检测，在后面的输出就如下（如果成功了）：")]),a._v(" "),s("div",{staticClass:"language-cmake line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cmake"}},[s("code",[a._v("-- The C compiler identification is GNU "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("11.4.0")]),a._v("\n-- Detecting C compiler ABI info\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])])]),a._v(" "),s("li",[s("p",[s("code",[a._v("add_executable(app main.c calc.c)")]),a._v("：生成一个可执行文件，名字叫做"),s("code",[a._v("app")]),a._v("，它依赖于后面这些啥的"),s("code",[a._v("main.c")]),a._v("、"),s("code",[a._v("calc.c")]),a._v("等源文件"),s("strong",[a._v("编译链接")]),a._v("而成")])]),a._v(" "),s("li",[s("p",[s("code",[a._v("target_include_directories(app PRIVATE .)")]),a._v("：当前的目标叫做"),s("code",[a._v("app")]),a._v("，在生成这个目标的时候的头文件（.h）去"),s("code",[a._v(".(CMakeLists.txt所在目录)")]),a._v("去找，不要在当前的"),s("code",[a._v("build")]),a._v("目录去找，你滴找不到，"),s("code",[a._v("PRIVATE")]),a._v("是指只能自己用，也去污染别的环境")])])]),a._v(" "),s("p",[a._v("当然，也可以在"),s("code",[a._v("CMakeLists.txt")]),a._v("中写一下C标准和编译参数，在"),s("code",[a._v("project()")]),a._v("和"),s("code",[a._v("add_executable()")]),a._v("之间")]),a._v(" "),s("div",{staticClass:"language-cmake line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-cmake"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("CMAKE_C_STANDARD")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("11")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 启用C11标准")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("CMAKE_C_FLAGS")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-Wall -g"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 打开所有警告和调试信息")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("hr"),a._v(" "),s("h3",{attrs:{id:"三、标准构建流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、标准构建流程"}},[a._v("#")]),a._v(" 三、标准构建流程")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" build\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" build\ncmake "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("\ncmake "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--build")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("要点：源码目录 ≠ 构建目录，build 目录可随时删除，增量编译由底层构建系统完成")]),a._v(" "),s("p",[a._v("如果构建成功了，会有如下的输出，最后只需要"),s("code",[a._v("./app")]),a._v("就可以运行"),s("code",[a._v("main.c")])]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("-- The C compiler identification is GNU "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("11.4")]),a._v(".0\n-- Detecting C compiler ABI info\n-- Detecting C compiler ABI info - "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("done")]),a._v("\n-- Configuring "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("done")]),a._v("\n-- Generating "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("done")]),a._v("\n-- Build files have been written to: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("./build\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])])])}),[],!1,null,null,null);s.default=n.exports}}]);