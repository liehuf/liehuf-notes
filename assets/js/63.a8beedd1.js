(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{432:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"c-语言文件操作详解-读写、定位、文本-vs-二进制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#c-语言文件操作详解-读写、定位、文本-vs-二进制"}},[t._v("#")]),t._v(" C 语言文件操作详解：读写、定位、文本 vs 二进制")]),t._v(" "),s("p",[t._v("在 C 语言里，文件操作是把程序的数据持久化、与外部资源交换的重要方式。\n无论你做的是日志、配置、序列化、还是读写二进制协议，都离不开文件 I/O。")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"一、文件操作的基本概念与模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、文件操作的基本概念与模式"}},[t._v("#")]),t._v(" 一、文件操作的基本概念与模式")]),t._v(" "),s("h3",{attrs:{id:"_1-文件是字节序列-stream-of-bytes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-文件是字节序列-stream-of-bytes"}},[t._v("#")]),t._v(" 1. 文件是字节序列（stream of bytes）")]),t._v(" "),s("p",[t._v("在 C 里，不论是“文本文件”还是“二进制文件”，在磁盘上都只是字节流。C 标准库把它抽象成 "),s("strong",[t._v("流（stream）")]),t._v("，每个流都由一个 "),s("code",[t._v("FILE *")]),t._v(" 指针来管理。")]),t._v(" "),s("p",[s("code",[t._v("stdio.h")]),t._v(" 里定义了关于流、缓冲、EOF、各种读写函数等的标准接口。")]),t._v(" "),s("h3",{attrs:{id:"_2-打开-关闭文件-fopen-fclose"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-打开-关闭文件-fopen-fclose"}},[t._v("#")]),t._v(" 2. 打开 / 关闭文件："),s("code",[t._v("fopen()")]),t._v(" / "),s("code",[t._v("fclose()")])]),t._v(" "),s("div",{staticClass:"language-c line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[t._v("FILE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fopen")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("filename"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("mode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fclose")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("FILE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("fp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("ul",[s("li",[s("code",[t._v("fopen")]),t._v("：给定文件名和打开模式，返回一个 "),s("code",[t._v("FILE*")]),t._v(" 流指针；若打开失败，返回 "),s("code",[t._v("NULL")]),t._v("。")]),t._v(" "),s("li",[s("code",[t._v("fclose")]),t._v("：关闭文件流、刷新缓冲、释放资源。成功返回 0，失败返回 "),s("code",[t._v("EOF")]),t._v("。")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("模式")]),t._v(" "),s("th",[t._v("含义（文本模式）")]),t._v(" "),s("th",[t._v("备注")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("code",[t._v('"r"')])]),t._v(" "),s("td",[t._v("只读，文件必须存在")]),t._v(" "),s("td",[t._v("读取模式，从文件头开始")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v('"w"')])]),t._v(" "),s("td",[t._v("只写，若不存在则创建；若存在则清空")]),t._v(" "),s("td",[t._v("写模式会先清空原内容")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v('"a"')])]),t._v(" "),s("td",[t._v("追加写，若不存在则创建")]),t._v(" "),s("td",[t._v("写入总是从文件尾开始")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v('"r+"')])]),t._v(" "),s("td",[t._v("读写模式，文件必须存在")]),t._v(" "),s("td",[t._v("不清空，既可读也可写")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v('"w+"')])]),t._v(" "),s("td",[t._v("读写模式，若已存在则清空")]),t._v(" "),s("td",[t._v("文件存在即被截断")])]),t._v(" "),s("tr",[s("td",[s("code",[t._v('"a+"')])]),t._v(" "),s("td",[t._v("读/追加写")]),t._v(" "),s("td",[t._v("可以读取，也可以一直追加写入")])])])]),t._v(" "),s("p",[t._v("如果是二进制文件，还要在模式里加 "),s("code",[t._v("b")]),t._v("，如 "),s("code",[t._v('"rb"')]),t._v(", "),s("code",[t._v('"wb+"')]),t._v(" 等。")]),t._v(" "),s("p",[t._v("⚠️ 在 Windows 平台上，若不加 "),s("code",[t._v("b")]),t._v("，写入或读取可能会把 "),s("code",[t._v("\\n")]),t._v(" 做成 "),s("code",[t._v("\\r\\n")]),t._v(" 或反之等转换。文本 vs 二进制模式的区别在于是否进行换行符的自动转换。")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"二、文本-i-o-按字符-按行-格式化写读"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、文本-i-o-按字符-按行-格式化写读"}},[t._v("#")]),t._v(" 二、文本 I/O：按字符 / 按行 / 格式化写读")]),t._v(" "),s("p",[t._v("这是最容易上手、最常用的一类文件操作。")]),t._v(" "),s("h3",{attrs:{id:"_1-写入字符-字符串-fputc-fputs-fprintf"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-写入字符-字符串-fputc-fputs-fprintf"}},[t._v("#")]),t._v(" 1. 写入字符 / 字符串："),s("code",[t._v("fputc()")]),t._v(", "),s("code",[t._v("fputs()")]),t._v(", "),s("code",[t._v("fprintf()")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("int fputc(int c, FILE *fp);")]),t._v("：写一个字符到文件。成功返回写入字符，否则返回 "),s("code",[t._v("EOF")]),t._v("。")]),t._v(" "),s("li",[s("code",[t._v("int fputs(const char *s, FILE *fp);")]),t._v("：写一个以 "),s("code",[t._v("\\0")]),t._v(" 结尾的字符串（不附加换行符）。成功返回非负值，失败返回 "),s("code",[t._v("EOF")]),t._v("。")]),t._v(" "),s("li",[s("code",[t._v("int fprintf(FILE *fp, const char *format, ...);")]),t._v("：类似 "),s("code",[t._v("printf")]),t._v("，带格式化功能，写入到文件流。")])]),t._v(" "),s("h3",{attrs:{id:"_2-读取字符-行-格式化读-fgetc-fgets-fscanf"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-读取字符-行-格式化读-fgetc-fgets-fscanf"}},[t._v("#")]),t._v(" 2. 读取字符 / 行 / 格式化读："),s("code",[t._v("fgetc()")]),t._v(", "),s("code",[t._v("fgets()")]),t._v(", "),s("code",[t._v("fscanf()")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("int fgetc(FILE *fp);")]),t._v("：从文件中读取一个字符。返回该字符（以 "),s("code",[t._v("int")]),t._v(" 形式），若遇错误或 EOF 返回 "),s("code",[t._v("EOF")])]),t._v(" "),s("li",[s("code",[t._v("char *fgets(char *buf, int n, FILE *fp);")]),t._v("：从流读取最多 "),s("code",[t._v("n-1")]),t._v(" 个字符，遇换行符或 EOF 停止，最后在字符串后加 "),s("code",[t._v("\\0")]),t._v("。如果读到 EOF 且没有读到字符则返回 "),s("code",[t._v("NULL")]),t._v("。")]),t._v(" "),s("li",[s("code",[t._v("int fscanf(FILE *fp, const char *format, ...);")]),t._v("：类似 "),s("code",[t._v("scanf")]),t._v("，按格式从文件中读取数据。遇空格、换行、格式不匹配等会停止。返回成功解析的项数或 "),s("code",[t._v("EOF")]),t._v("。")])]),t._v(" "),s("h3",{attrs:{id:"_3-检测文件结尾、错误"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-检测文件结尾、错误"}},[t._v("#")]),t._v(" 3. 检测文件结尾、错误")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("int feof(FILE *fp);")]),t._v("：检查是否已到文件末尾，若是返回非零。")]),t._v(" "),s("li",[s("code",[t._v("int ferror(FILE *fp);")]),t._v("：检测流的错误状态。")]),t._v(" "),s("li",[s("code",[t._v("void clearerr(FILE *fp);")]),t._v("：清除流的错误/EOF 标志。")])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"三、二进制-i-o-fread-fwrite"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、二进制-i-o-fread-fwrite"}},[t._v("#")]),t._v(" 三、二进制 I/O："),s("code",[t._v("fread()")]),t._v(" / "),s("code",[t._v("fwrite()")])]),t._v(" "),s("p",[t._v("当你要以“块”为单位读写内存（如数组、结构体、图像数据、网络协议包等），用文本 I/O 有时不合适，二进制 I/O 更高效、精确。")]),t._v(" "),s("div",{staticClass:"language-c line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("size_t")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("ptr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("size_t")]),t._v(" size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("size_t")]),t._v(" nmemb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" FILE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("size_t")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fwrite")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("ptr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("size_t")]),t._v(" size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("size_t")]),t._v(" nmemb"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" FILE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("stream"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("ul",[s("li",[s("code",[t._v("ptr")]),t._v("：内存地址，读入或写出的目标")]),t._v(" "),s("li",[s("code",[t._v("size")]),t._v("：单个元素的字节大小")]),t._v(" "),s("li",[s("code",[t._v("nmemb")]),t._v("：元素个数")]),t._v(" "),s("li",[t._v("返回值：成功读写的元素数目（不是字节数）")])]),t._v(" "),s("p",[t._v("例如，用 "),s("code",[t._v("fwrite(&obj, sizeof(obj), 1, fp)")]),t._v(" 把结构体写入文件；用 "),s("code",[t._v("fread(&obj2, sizeof(obj2), 1, fp)")]),t._v(" 读回来。")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"四、定位-偏移-fseek-ftell-rewind"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、定位-偏移-fseek-ftell-rewind"}},[t._v("#")]),t._v(" 四、定位 / 偏移："),s("code",[t._v("fseek()")]),t._v(", "),s("code",[t._v("ftell()")]),t._v(", "),s("code",[t._v("rewind()")])]),t._v(" "),s("p",[t._v("有时候你不希望按顺序读写，而是“跳转”到文件某个位置去操作。")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("int fseek(FILE *stream, long offset, int whence);")]),t._v("：移动文件内部指针\n"),s("ul",[s("li",[s("code",[t._v("SEEK_SET")]),t._v(" 从文件头开始")]),t._v(" "),s("li",[s("code",[t._v("SEEK_CUR")]),t._v(" 从当前位置")]),t._v(" "),s("li",[s("code",[t._v("SEEK_END")]),t._v(" 从文件尾")])])]),t._v(" "),s("li",[s("code",[t._v("long ftell(FILE *stream);")]),t._v("：返回当前文件指针相对于文件开头的偏移（字节数）")]),t._v(" "),s("li",[s("code",[t._v("void rewind(FILE *stream);")]),t._v("：等价于 "),s("code",[t._v("fseek(stream, 0, SEEK_SET)")]),t._v("，把指针移到文件头。"),s("a",{attrs:{href:"https://www.cnblogs.com/bigflyny/p/17607533.html?utm_source=chatgpt.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("博客园+1"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("例如，可以用 "),s("code",[t._v("fseek(fp, 0, SEEK_END)")]),t._v(" + "),s("code",[t._v("ftell()")]),t._v(" 来测文件大小。")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"五、典型代码示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、典型代码示例"}},[t._v("#")]),t._v(" 五、典型代码示例")]),t._v(" "),s("p",[t._v("下面是一个综合示例，演示文本读写 + 二进制读写 + 定位操作：")]),t._v(" "),s("div",{staticClass:"language-c line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("<stdio.h>")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token macro property"}},[s("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("<stdlib.h>")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typedef")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" Record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    FILE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("fp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ——————— 写文本 + 写二进制 ———————")]),t._v("\n    fp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fopen")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"data.txt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"w"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("perror")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"打开 data.txt 失败"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fprintf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello, 文件操作!\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fputs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"再写一行文本。\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fclose")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    fp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fopen")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"data.bin"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"wb"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("perror")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"打开 data.bin 失败"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    Record rec1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.14f")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 把结构体写入二进制文件")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fwrite")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("rec1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sizeof")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("perror")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fwrite 失败"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fclose")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ——————— 读文本文件 ———————")]),t._v("\n    fp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fopen")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"data.txt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"r"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("perror")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"打开 data.txt 失败"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),t._v(" buf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fgets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sizeof")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"读到一行：%s"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" buf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fclose")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ——————— 读二进制 + 定位测试 ———————")]),t._v("\n    fp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fopen")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"data.bin"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rb"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fp "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("perror")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"打开 data.bin 失败"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 找到文件末尾，测大小")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fseek")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SEEK_END")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" sz "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ftell")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"data.bin 的大小 = %ld 字节\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sz"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rewind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指针回到头")]),t._v("\n    Record rec2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fread")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("rec2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sizeof")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"读取结构体：id = %d, value = %.2f\\n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n               rec2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" rec2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("perror")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fread 失败"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("fclose")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br"),s("span",{staticClass:"line-number"},[t._v("46")]),s("br"),s("span",{staticClass:"line-number"},[t._v("47")]),s("br"),s("span",{staticClass:"line-number"},[t._v("48")]),s("br"),s("span",{staticClass:"line-number"},[t._v("49")]),s("br"),s("span",{staticClass:"line-number"},[t._v("50")]),s("br"),s("span",{staticClass:"line-number"},[t._v("51")]),s("br"),s("span",{staticClass:"line-number"},[t._v("52")]),s("br"),s("span",{staticClass:"line-number"},[t._v("53")]),s("br"),s("span",{staticClass:"line-number"},[t._v("54")]),s("br"),s("span",{staticClass:"line-number"},[t._v("55")]),s("br"),s("span",{staticClass:"line-number"},[t._v("56")]),s("br"),s("span",{staticClass:"line-number"},[t._v("57")]),s("br"),s("span",{staticClass:"line-number"},[t._v("58")]),s("br"),s("span",{staticClass:"line-number"},[t._v("59")]),s("br"),s("span",{staticClass:"line-number"},[t._v("60")]),s("br"),s("span",{staticClass:"line-number"},[t._v("61")]),s("br"),s("span",{staticClass:"line-number"},[t._v("62")]),s("br"),s("span",{staticClass:"line-number"},[t._v("63")]),s("br"),s("span",{staticClass:"line-number"},[t._v("64")]),s("br"),s("span",{staticClass:"line-number"},[t._v("65")]),s("br"),s("span",{staticClass:"line-number"},[t._v("66")]),s("br"),s("span",{staticClass:"line-number"},[t._v("67")]),s("br")])]),s("p",[s("strong",[t._v("说明要点：")])]),t._v(" "),s("ul",[s("li",[t._v("我们用 "),s("code",[t._v("fprintf")]),t._v(" / "),s("code",[t._v("fputs")]),t._v(" 写文本，用 "),s("code",[t._v("fgets")]),t._v(" 读文本；")]),t._v(" "),s("li",[t._v("用 "),s("code",[t._v("fwrite")]),t._v(" / "),s("code",[t._v("fread")]),t._v(" 写/读结构体（二进制）；")]),t._v(" "),s("li",[t._v("用 "),s("code",[t._v("fseek")]),t._v(" + "),s("code",[t._v("ftell")]),t._v(" 得到文件大小；")]),t._v(" "),s("li",[t._v("用 "),s("code",[t._v("rewind")]),t._v(" 重置文件位置。")])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"六、常见坑点-注意事项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#六、常见坑点-注意事项"}},[t._v("#")]),t._v(" 六、常见坑点 / 注意事项")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("⚠️ 问题")]),t._v(" "),s("th",[t._v("说明 / 经验教训")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[s("strong",[t._v("检查 "),s("code",[t._v("fopen")]),t._v(" 返回值")])]),t._v(" "),s("td",[t._v("打开失败要马上处理，别拿 "),s("code",[t._v("NULL")]),t._v(" 去读写。")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("缓冲刷新 / 数据丢失")])]),t._v(" "),s("td",[t._v("写操作最后要 "),s("code",[t._v("fclose()")]),t._v(" 或 "),s("code",[t._v("fflush()")]),t._v("，否则缓冲里的数据可能没写到文件上。")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("文本 vs 二进制模式差异")])]),t._v(" "),s("td",[t._v("在 Windows 上，不加 "),s("code",[t._v("b")]),t._v(" 模式可能造成 "),s("code",[t._v("\\n ↔ \\r\\n")]),t._v(" 转换。")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("结构体二进制可移植性")])]),t._v(" "),s("td",[t._v("结构体的内存布局可能因对齐、字节序（Endian）、编译器差异而不同，不宜在不同平台直接用二进制方式交换结构体。")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("不要混用文本和二进制读写")])]),t._v(" "),s("td",[t._v("若用文本函数去读写二进制数据可能出错。最好明确一个文件是“纯文本”或“纯二进制”。")])]),t._v(" "),s("tr",[s("td",[s("strong",[s("code",[t._v("fseek")]),t._v(" 在追加模式下不总能改变写入位置")])]),t._v(" "),s("td",[t._v("如果文件以 append 模式打开（如 "),s("code",[t._v('"a"')]),t._v(" 或 "),s("code",[t._v('"a+"')]),t._v("），写入操作仍然可能强制在文件尾。")])]),t._v(" "),s("tr",[s("td",[s("strong",[s("code",[t._v("ftell")]),t._v(" / "),s("code",[t._v("fseek")]),t._v(" 的返回值 / 错误情况")])]),t._v(" "),s("td",[s("code",[t._v("ftell")]),t._v(" 出错返回 "),s("code",[t._v("-1L")]),t._v("，要检查；"),s("code",[t._v("fseek")]),t._v(" 成功返回 0，失败返回非零。")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("循环读写判断 EOF")])]),t._v(" "),s("td",[t._v("使用 "),s("code",[t._v("while (fgets(...) != NULL)")]),t._v("、或 "),s("code",[t._v("while (fread(...) == expected_count)")]),t._v("，避免用 "),s("code",[t._v("feof")]),t._v(" 作为主循环条件。")])]),t._v(" "),s("tr",[s("td",[s("strong",[t._v("文件名 / 路径")])]),t._v(" "),s("td",[t._v("使用完整路径、注意操作系统的路径分隔符（Linux "),s("code",[t._v("/")]),t._v("，Windows "),s("code",[t._v("\\")]),t._v(" 或 "),s("code",[t._v("/")]),t._v("），以及目录是否存在。")])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);