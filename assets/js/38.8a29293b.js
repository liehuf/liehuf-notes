(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{411:function(a,t,s){"use strict";s.r(t);var e=s(2),n=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"makefile及其变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#makefile及其变量"}},[a._v("#")]),a._v(" MakeFile及其变量")]),a._v(" "),t("h2",{attrs:{id:"一、对于makefile本身的理解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一、对于makefile本身的理解"}},[a._v("#")]),a._v(" 一、对于Makefile本身的理解")]),a._v(" "),t("blockquote",[t("p",[a._v("Makefile 不是“另一种编译器”，它是“编译流程的调度器”。")])]),a._v(" "),t("p",[a._v("在初学C时使用"),t("code",[a._v("gcc")]),a._v("，编译一个"),t("code",[a._v("main.c")]),a._v("只需要")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("gcc main.c "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-o")]),a._v(" main\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("但是，当工程变成如下的架构，一系列问题都被抛出：哪些.o要输出？哪些.c是新的？交叉编译怎么切换编译器？")]),a._v(" "),t("div",{staticClass:"language-Plain text line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-plain"}},[t("code",[a._v("main.c\nuart.c\nspi.c\ni2c.c\ndrivers/\n  gpio.c\n  timer.c\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br")])]),t("h3",{attrs:{id:"makefile的最小模型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#makefile的最小模型"}},[a._v("#")]),a._v(" Makefile的最小模型")]),a._v(" "),t("div",{staticClass:"language-Makefile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-makefile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token target symbol"}},[a._v("目标")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" 依赖\n\t命令\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[a._v("e.g.")]),a._v(" "),t("div",{staticClass:"language-makefile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-makefile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token target symbol"}},[a._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" main.o uart.o\n\tgcc -o app main.o uart.o\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[a._v("这个例子可以读作：")]),a._v(" "),t("blockquote",[t("p",[a._v("我要得到 app，必须先有 main.o 和 uart.o， 如果它们比 app 新，就执行下面的命令。")])]),a._v(" "),t("h2",{attrs:{id:"二、变量的定义和分类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#二、变量的定义和分类"}},[a._v("#")]),a._v(" 二、变量的定义和分类")]),a._v(" "),t("h3",{attrs:{id:"_1-基础变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-基础变量"}},[a._v("#")]),a._v(" 1. 基础变量")]),a._v(" "),t("p",[a._v("递归展开变量："),t("code",[a._v("=")]),a._v("，用的时候再展开")]),a._v(" "),t("p",[a._v("立即展开变量："),t("code",[a._v(":=")]),a._v("，定义的时候直接展开，值固定")]),a._v(" "),t("p",[a._v("引用方式：")]),a._v(" "),t("div",{staticClass:"language-makefile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-makefile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("CC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("CFLAGS"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" -o app "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("SRC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("一般用$(...)的形式引用")]),a._v(" "),t("h3",{attrs:{id:"_2-自动变量"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-自动变量"}},[a._v("#")]),a._v(" 2. 自动变量")]),a._v(" "),t("p",[a._v("在执行时，自动填好，以避免手动书写多个重复的文件名，只在"),t("strong",[a._v("规则命令里面生效")])]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"center"}},[a._v("变量")]),a._v(" "),t("th",{staticStyle:{"text-align":"center"}},[a._v("含义")])])]),a._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"center"}},[t("code",[a._v("$@")])]),a._v(" "),t("td",{staticStyle:{"text-align":"center"}},[a._v("规则中的目标文件")])]),a._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[t("code",[a._v("$<")])]),a._v(" "),t("td",{staticStyle:{"text-align":"center"}},[a._v("规则中的第一个依赖文件")])]),a._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[t("code",[a._v("$^")])]),a._v(" "),t("td",{staticStyle:{"text-align":"center"}},[a._v("规则中的所有依赖文件（去重）")])]),a._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[t("code",[a._v("$?")])]),a._v(" "),t("td",{staticStyle:{"text-align":"center"}},[a._v("比目标新的所有依赖文件")])]),a._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[t("code",[a._v("$*")])]),a._v(" "),t("td",{staticStyle:{"text-align":"center"}},[a._v("匹配符"),t("code",[a._v("%")]),a._v("匹配的部分")])])])]),a._v(" "),t("h3",{attrs:{id:"_3-内置变量-makefile的工程接口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-内置变量-makefile的工程接口"}},[a._v("#")]),a._v(" 3. 内置变量（Makefile的工程接口）")]),a._v(" "),t("p",[a._v("make "),t("strong",[a._v("默认已经定义好一些变量")]),a._v("，这些变量可以直接用：")]),a._v(" "),t("ul",[t("li",[t("code",[a._v("CC")]),a._v("：C 编译器")]),a._v(" "),t("li",[t("code",[a._v("AR")]),a._v("：静态库工具")]),a._v(" "),t("li",[t("code",[a._v("RM")]),a._v("：删除命令")])]),a._v(" "),t("h3",{attrs:{id:"_4-变量函数-makefile会处理文件列表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-变量函数-makefile会处理文件列表"}},[a._v("#")]),a._v(" 4. 变量函数（Makefile会处理文件列表）")]),a._v(" "),t("h4",{attrs:{id:"wildcard-从文件系统取文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#wildcard-从文件系统取文件"}},[a._v("#")]),a._v(" "),t("code",[a._v("wildcard")]),a._v(" —— 从文件系统取文件")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("SRC :"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("wildcard src/*.c"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("blockquote",[t("p",[t("strong",[a._v("列出 src 目录下所有 "),t("code",[a._v(".c")]),a._v(" 文件")]),a._v("，但不递归子目录")])]),a._v(" "),t("h4",{attrs:{id:"patsubst-批量替换"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#patsubst-批量替换"}},[a._v("#")]),a._v(" "),t("code",[a._v("patsubst")]),a._v(" —— 批量替换")]),a._v(" "),t("div",{staticClass:"language-makefile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-makefile"}},[t("code",[a._v("OBJ "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("patsubst")]),a._v(" %.c,%.o,"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("SRC"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("作用：")]),a._v(" "),t("div",{staticClass:"language-makefile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-makefile"}},[t("code",[a._v("a.c b.c → a.o b.o\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("这是从 "),t("code",[a._v(".c")]),a._v(" 推导 "),t("code",[a._v(".o")]),a._v(" 的标准方式。")]),a._v(" "),t("h4",{attrs:{id:"dir-notdir-找目录-文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dir-notdir-找目录-文件"}},[a._v("#")]),a._v(" dir / notdir（找目录/文件）")]),a._v(" "),t("div",{staticClass:"language-makefile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-makefile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("dir")]),a._v(" src/test.c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("     → src/\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("notdir")]),a._v(" src/test.c"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  → test.c\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[a._v("用于：")]),a._v(" "),t("ul",[t("li",[a._v("自动创建目录")]),a._v(" "),t("li",[a._v("分离路径和文件名")])])])}),[],!1,null,null,null);t.default=n.exports}}]);